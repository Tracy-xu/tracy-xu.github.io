<!-- build time:Wed Aug 17 2022 14:32:46 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Tracy-xu&#39;Blog"><meta name="author" content="Tracy Xu"><meta property="og:title" content="互动直播课堂前端技术设计"><meta property="og:description" content="Tracy-xu&#39;Blog"><meta property="og:site_name" content="Tracy-xu&#39;Blog"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><title>互动直播课堂前端技术设计 - Tracy-xu&#39;Blog</title><link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css" type="text/css"><link href="/plugins/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet"><link href="/plugins/featherlight/featherlight.min.css" type="text/css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"></head><body><div class="bg-gradient"></div><div class="bg-pattern"></div><div class="menu-bg"><div class="menu-container"><ul><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/about.html">关于我</a></li></ul></div></div><nav><a href="#menu"></a></nav><div class="container"><div class="row"><div class="col-sm-12"><header><div class="logo"><a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a></div></header><section class="main"><div class="post"><div class="post-header"><h1 class="title"><a href="/2020/10/01/Interact-Live-Class/">互动直播课堂前端技术设计</a></h1><div class="post-info"><span class="date">2020-10-01</span> <span class="category"><a href="/categories/project/">project</a></span></div></div><div class="content"><p>按同屏的技术实现方式来划分，课堂分为<strong>录屏课堂</strong>和<strong>指令课堂</strong>。指令课堂的操作状态需要恢复，录屏课堂中不是必须的，不管是录屏课堂还是指令课堂，互动操作（比如，聊天、点名、授权、问答…）都要通过指令实现。指令课堂适用于面对面课堂，录屏课堂适用于远程课堂。</p><p>指令同屏中可以选择同屏的内容，这样可以保护隐私。</p><a id="more"></a><h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>按使用场景来划分，课堂又分为<strong>面对面课堂</strong>和<strong>远程课堂</strong>。面对面课堂作为线下课堂的补充，而远程课堂可用来替代线下课堂。</p><ul><li>基础功能</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 黑板（截图）</span><br><span class="line">* 音视频直播(摄像头、桌面，rtmp、hls、flv --- http cdn，rtc)</span><br><span class="line">* 学生列表（支持授权还有举手列表）</span><br><span class="line">* 授权（授权书写、语音、视频）</span><br><span class="line">* 课件（预览、上传，支持二维码上传，img、ppt、pdf、doc、media）</span><br><span class="line">* 聊天（可禁言）</span><br><span class="line">* 投票</span><br><span class="line">* 点名</span><br><span class="line">* 抽人</span><br><span class="line">* 计时器</span><br><span class="line">* 录像</span><br></pre></td></tr></table></figure><p>基础版课堂，能够满足基本的直播和白板需求，适用于远程教学、视频会议、白板等场景。</p><ul><li>K12 教学功能</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 问答（自由题目和备课题目）</span><br><span class="line">* 讲解题目/问答/作业</span><br></pre></td></tr></table></figure><p>注：测验的三种方式 — 问答、作业、考试。问答只能在课堂中进行，其他两种类型在课前（预习）、课中（随堂）、课后进行都可以。</p><h2 id="业务设计"><a href="#业务设计" class="headerlink" title="业务设计"></a>业务设计</h2><ul><li>登录</li></ul><p>登录</p><p>会话保持</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localStorage + http header</span><br></pre></td></tr></table></figure><p>登录刷新</p><ul><li>鉴权</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">接口鉴权</span><br><span class="line">前端 UI 鉴权</span><br><span class="line">前端 Router 鉴权</span><br></pre></td></tr></table></figure><p>依赖于后端接口的 UI 不需要处理，但是不依赖的呢，有些（非操作类，不会触发后续请求的接口，因为这类 UI 无法通过后端接口来处理）就需要处理</p><ul><li>课堂控制</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 开始上课</span><br><span class="line">* 结束上课</span><br><span class="line">* 拖堂</span><br><span class="line">* 课堂倒计时</span><br></pre></td></tr></table></figure><ul><li>恢复</li></ul><p>恢复接口返回数据结构：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...</span><br></pre></td></tr></table></figure><p>课堂恢复的数据存在 Vuex。</p><ul><li>角色</li></ul><p>多角色设计。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 老师</span><br><span class="line">* 学生</span><br><span class="line">* 助教</span><br><span class="line">* 游客</span><br></pre></td></tr></table></figure><ul><li>授权</li></ul><p>十进制的展示和传输，二进制的语义</p><p>二进制表达的目的是为了能够组合表达，这样就能够表达多种状态</p><p>黑板：1 — 001<br>音频：2 — 010<br>视频：4 — 100 # 纯视频</p><p>判断：<br>(1xx &amp; 4) === 4</p><p>更新：<br>6 ^ 4 // 2</p><ul><li>问答</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* 做题组件的设计（显示、作答、讲解）</span><br></pre></td></tr></table></figure><ul><li>讲解</li></ul><p>讲题目、讲答案、对比讲解答案、讲报告。</p><ul><li>黑板</li></ul><p>黑板配置没有做同步（老师 PC 和 老师平板），需要做吗</p><h2 id="技术设计"><a href="#技术设计" class="headerlink" title="技术设计"></a>技术设计</h2><ul><li>窗口</li></ul><p>非模态弹框被称为窗口，由于非模态的原因，就需要考虑窗口的排序</p><ul><li>同屏</li></ul><p>应用的宽高比<br>同屏与主控比</p><p>可以按提前商定宽高适配比例适配（适用于定制设备），也可以按主控的宽高比做适配。</p><p>提前商定适配尺寸，位置数据适配比例需要转化为中间比例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scale2Server(state, getters) &#123;</span><br><span class="line">  return 768 / getters.appWidth;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">scale2Client(state, getters) &#123;</span><br><span class="line">  return getters.appWidth / 768;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>如果按主控来适配，直接</p><ul><li>音视频直播</li></ul><p>播放器</p><p>两路流，混流。</p><p><a href="https://www.jianshu.com/p/32417d8ee5b6" target="_blank" rel="noopener">https://www.jianshu.com/p/32417d8ee5b6</a></p><ul><li>WebSocket 设计</li></ul><p>长链接实时应用熄屏</p><h3 id="Ajax-接口设计和调用"><a href="#Ajax-接口设计和调用" class="headerlink" title="Ajax 接口设计和调用"></a>Ajax 接口设计和调用</h3><ul><li>API 管理</li></ul><p>按业务模块划分，再由一个文件同意导出，方便管理。</p><ul><li>Axios 的设置</li></ul><p>Websorket 直接返回的是服务端数据，不管是成功还是错误。但是经 Axios 的 Ajax 返回被包裹了一层。</p><p>/lesson/xxx 开头的接口用的是 lesson_token，其他用的都是 lesson_access_token</p><p>其实大部分情况下，调的都是课外接口</p><ul><li>catch</li></ul><p>服务器端异常提示，统一在 Axios 响应拦截器里拦截，不需要调用接口时一个个 catch（参考 Promise 章节），比如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">api.usHandUp().then(response =&gt; &#123;</span><br><span class="line">  this.handUpStatus = true;</span><br><span class="line">&#125;).catch(error =&gt; &#123;</span><br><span class="line">  this.$message(&#123;</span><br><span class="line">    message: error.msg,</span><br><span class="line">    type: &apos;warning&apos;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Vuex-设计"><a href="#Vuex-设计" class="headerlink" title="Vuex 设计"></a>Vuex 设计</h3><h3 id="Socket-接口设计"><a href="#Socket-接口设计" class="headerlink" title="Socket 接口设计"></a>Socket 接口设计</h3><ul><li>WebSocket 库设计</li></ul><p>注：Socket 接口不一定非要用于推送，也可以当 HTTP 接口一样的用，也会有返回。</p><ul><li>数据的同步和恢复</li></ul><h2 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h2><p>http 接口都带了 token，socket 接口没带？</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul><li>游客快速问答的恢复</li><li>移除 Ajax 接口业务中的 catch</li></ul></div></div></section></div></div></div><div class="push"></div><footer class="footer-content"><div class="container"><div class="row"><div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-about"><h2>About</h2><p>享受编程和技术所带来的快乐</p></div><div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-categories"><h2>Categories</h2><p><a class="footer-post" href="/categories/html/">html</a> <a class="footer-post" href="/categories/scratch/">scratch</a> <a class="footer-post" href="/categories/jotting/">jotting</a> <a class="footer-post" href="/categories/algorithms/">algorithms</a></p></div><div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-search"><h2>Search</h2><form class="site-search-form"><input type="text" id="local-search-input" class="st-search-input"></form><div id="local-search-result" class="local-search-result-cls"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><ul class="list-inline footer-social-icons"></ul></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><div class="footer-copyright">Copyright©Tracy-xu'Blog. All Rights Reserved.</div></div></div></div></footer><script src="/plugins/jquery-2.1.4.min.js"></script><script src="/plugins/TweenMax.min.js"></script><script src="/plugins/featherlight/featherlight.min.js"></script><script src="/js/main.js"></script></body></html><!-- rebuild by neat -->