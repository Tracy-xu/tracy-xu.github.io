<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Tracy-xu&#39;Blog">
    

    <!--Author-->
    
        <meta name="author" content="Tracy Xu">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="互动直播课堂前端设计"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Tracy-xu&#39;Blog" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Tracy-xu&#39;Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>互动直播课堂前端设计 - Tracy-xu&#39;Blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom Fonts -->
    <link href="/plugins/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />

    <!-- Gallery -->
    <link href="/plugins/featherlight/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/static/katex.min.css">

<link rel="stylesheet" href="/static/hexo-math.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Tracy-xu'Blog" type="application/atom+xml">
</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    首页
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    归档
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    分类
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    关于我
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav class="menu-bar">
    <a></a>
</nav>


<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2021/10/02/project/Interact-Live-Class/">
                互动直播课堂前端设计
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-10-02</span>
            
            
            
                <span class="category">
                    <a href="/categories/项目设计/">项目设计</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>作为在线教育的核心产品，课堂既要满足<strong>面对面</strong>场景，又要满足<strong>远程</strong>场景，面对面课堂作为线下课堂的补充，而远程课堂可用来替代线下课堂。</p>
<span id="more"></span>

<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>基础版课堂，能够满足基本的直播和白板需求，适用于视频会议、白板等通用场景，加入教学功能，则适用于教学场景。</p>
<ul>
<li>基础功能</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 黑板</span><br><span class="line">* 截图</span><br><span class="line">* 学生列表</span><br><span class="line">* 举手</span><br><span class="line">* 授权（授权书写、语音、视频）</span><br><span class="line">* 课件（上传和预览）</span><br><span class="line">* 聊天（禁言）</span><br><span class="line">* 投票</span><br><span class="line">* 点名</span><br><span class="line">* 抽人</span><br><span class="line">* 计时器</span><br><span class="line">* 同屏</span><br><span class="line">* 直播（摄像头、桌面，rtmp、hls、flv --- http cdn，rtc）</span><br><span class="line">* 录像</span><br></pre></td></tr></table></figure>

<ul>
<li>教学功能</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 课本</span><br><span class="line">* 课课清作业</span><br><span class="line">* 问答（自由题型和备课题型）</span><br><span class="line">* 抢答</span><br><span class="line">* 讲解（题目、作业、问答）</span><br></pre></td></tr></table></figure>

<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><ul>
<li>基本流程</li>
</ul>
<p>课外排课创建课堂，生成课堂凭证 <code>ticket</code>，凭 <code>ticket</code> 检票进入课堂，检票完成后生成 <code>stub</code> 票根，凭 <code>stub</code> 票根链接 WebSocket，登录课堂，登录成功后，返回课堂 token，正式进入课堂。</p>
<p>课堂成功进入后，会恢复课堂，<code>API.User.recover()</code> 接口调用成功后，会发布两个钩子事件 <code>lessonInit</code> 和 <code>lessonInited</code>，各个业务模块的 store 订阅这两个事件，取自己模块所需数据，即可恢复课堂。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录课堂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; hostId &#125; = params;</span><br><span class="line">  <span class="keyword">const</span> url = process.<span class="property">env</span>.<span class="property">VUE_APP_WS_URL</span>.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;hostId&#125;&#x27;</span>, hostId);</span><br><span class="line">  <span class="variable constant_">WS</span>.<span class="title function_">create</span>(url, params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录成功</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable constant_">WS</span>.<span class="property">instance</span>.<span class="title function_">on</span>(<span class="string">&#x27;auth_success&#x27;</span>, <span class="function">(<span class="params">rep</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; token &#125; = rep.<span class="property">data</span>;</span><br><span class="line">  <span class="title function_">dispatch</span>(<span class="string">&#x27;recover&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 恢复课堂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">recover</span>(<span class="params">&#123; dispatch &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="variable constant_">API</span>.<span class="property">User</span>.<span class="title function_">recover</span>();</span><br><span class="line">  <span class="title function_">dispatch</span>(<span class="string">&#x27;lessonInit&#x27;</span>, &#123; <span class="attr">lesson</span>: data &#125;, &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  <span class="title function_">dispatch</span>(<span class="string">&#x27;lessonInited&#x27;</span>, &#123; &#125;, &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div id="flowchart-0" class="flow-chart"></div>

<ul>
<li>WebSocket 客户端设计</li>
</ul>
<p>支持 Proise 调用，掉线重连。</p>
<ul>
<li>课堂控制</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 开始上课</span><br><span class="line">* 结束上课</span><br><span class="line">* 拖堂</span><br><span class="line">* 课堂倒计时</span><br></pre></td></tr></table></figure>

<ul>
<li>同屏</li>
</ul>
<p>按同屏技术实现方式分，课堂可分为<strong>录屏课堂</strong>和<strong>指令同屏课堂</strong>，远程课堂中可使用录屏实现同屏，没有直播的面对面场景中（主控同屏端、学生、助教、游客）可使用指令同屏。</p>
<p>相比于录屏同屏，指令同屏实现更复杂，特别是坐标数据的适配。坐标适配前提是应用的适配，被控端按主控端的应用的比例适配，应用适配后再去适配坐标数据，需要适配的同屏数据常有：轨迹、滚动位置。</p>
<ul>
<li>恢复</li>
</ul>
<p>数据恢复的目的是为了保证业务的进行和操作的同屏，需要恢复的数据有业务数据与前端自定义数据（临时操作状态数据不需要保存恢复），业务数据（点名、抢答、授权、问答、举手…）存储在各自字段中，而前端自定义数据（指的是在后端没有业务的数据：比如，同屏数据、窗口数据…）存储在 funcs 通用字段中。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 房间信息</span></span><br><span class="line">  <span class="attr">&quot;room&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 业务数据：点名、抢答、授权、问答、举手、作答器</span></span><br><span class="line">    <span class="attr">&quot;call&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;grab&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;permits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;quiz&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;raisedCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 通用功能列表</span></span><br><span class="line">    <span class="attr">&quot;funcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 房间自定义设置</span></span><br><span class="line">    <span class="attr">&quot;setup&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 房间状态</span></span><br><span class="line">    <span class="attr">&quot;states&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 个人信息</span></span><br><span class="line">  <span class="attr">&quot;self&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 业务数据：抢答、问答</span></span><br><span class="line">    <span class="attr">&quot;grab&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;quiz&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 个人状态</span></span><br><span class="line">    <span class="attr">&quot;states&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>角色</li>
</ul>
<p>多角色设计。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 老师</span><br><span class="line">* 学生</span><br><span class="line">* 助教</span><br><span class="line">* 游客</span><br></pre></td></tr></table></figure>

<ul>
<li>黑板</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 轨迹（并发、同步、恢复、适配）</span><br><span class="line">* 图型</span><br></pre></td></tr></table></figure>

<ul>
<li>多层窗口</li>
</ul>
<p>非模态弹框被称为窗口，由于非模态的原因，需要考虑窗口的排序。</p>
<ul>
<li>授权</li>
</ul>
<p>用二进制可以很方便的表达、计算和判断多个组合的开合状态。各种权限的 feature 权值如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">黑板：001 --- 1</span><br><span class="line">音频：010 --- 2</span><br><span class="line">视频：100 --- 4</span><br></pre></td></tr></table></figure>

<p>比如，111 表示黑板、音频、视频的权限全部被开启，000 表示权限全部被关闭。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断当前权限：当前权限 &amp; feature</span></span><br><span class="line"><span class="number">6</span> &amp; <span class="number">4</span>; <span class="comment">// 4</span></span><br><span class="line"><span class="number">2</span> &amp; <span class="number">4</span>; <span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 切换权限：当前权限 ^ feature</span></span><br><span class="line"><span class="number">6</span> ^ <span class="number">4</span>; <span class="comment">// 2</span></span><br><span class="line"><span class="number">2</span> ^ <span class="number">4</span>; <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>

<ul>
<li>问答</li>
</ul>
<p>做题组件的设计（显示、作答、讲解）。</p>
<ul>
<li>讲解</li>
</ul>
<p>讲题目、讲答案、对比讲解答案、讲报告。</p>
<ul>
<li>聊天</li>
</ul>
<p>虚拟滚动，XSS。<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.17.1/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">start=>start: 开始
op1=>operation: 创建课堂
io1=>inputoutput: 生成 roomId (课堂 ID)
op2=>operation: 申请 ticket (课堂凭证)
io2=>inputoutput: 生成 ticket
op3=>operation: 检测凭证
io3=>inputoutput: 生成 stub (票根)
op4=>operation: 登录课堂 (创建 WS 链接)
io5=>operation: 登录成功，生成 token
op6=>operation: 恢复课堂
op7=>operation: 开始上课
op8=>operation: 结束课堂
end=>end: 结束

start(right)->op1(right)->io1(right)->op2(right)->io2(bottom)->op3->io3->op4->op6->op7->op8->end</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script></p>

    </div>

    

    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-about">
                <h2>About</h2>
                <p>
                    愿你走出半生，归来仍是少年
                </p>
            </div>
            
<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-categories">
    <h2>Categories</h2>
    <p>
        
        <a class="footer-post" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
        
        <a class="footer-post" href="/categories/%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1/">项目设计</a>
        
        <a class="footer-post" href="/categories/%E5%B0%91%E5%84%BF%E7%BC%96%E7%A8%8B/">少儿编程</a>
        
        <a class="footer-post" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a>
        
    </p>
</div>

            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-search">
    <h2>Search</h2>
    <form class="site-search-form">
        <input type="text" id="local-search-input" class="st-search-input" />
    </form>
    <div id="local-search-result" class="local-search-result-cls"></div>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    Copyright©Tracy-xu'Blog. All Rights Reserved.
                </div>
            </div>
        </div>
    </div>
</footer>


<!-- After footer scripts -->

<!-- jQuery -->
<script src="/plugins/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="/plugins/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="/plugins/featherlight/featherlight.min.js"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>
