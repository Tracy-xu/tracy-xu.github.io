<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Tracy-xu&#39;Blog">
    

    <!--Author-->
    
        <meta name="author" content="Tracy Xu">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="TypeScript 全解"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Tracy-xu&#39;Blog" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Tracy-xu&#39;Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>TypeScript 全解 - Tracy-xu&#39;Blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom Fonts -->
    <link href="/plugins/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />

    <!-- Gallery -->
    <link href="/plugins/featherlight/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/static/katex.min.css">

<link rel="stylesheet" href="/static/hexo-math.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Tracy-xu'Blog" type="application/atom+xml">
</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    首页
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    归档
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    分类
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    关于我
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav class="menu-bar">
    <a></a>
</nav>


<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2022/06/01/javascript/Typescript%20%E5%85%A8%E8%A7%A3/">
                TypeScript 全解
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2022-06-01</span>
            
            
            
                <span class="category">
                    <a href="/categories/JavaScript/">JavaScript</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/136254808">https://zhuanlan.zhihu.com/p/136254808</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/542379032?utm_id=0">https://zhuanlan.zhihu.com/p/542379032?utm_id=0</a></p>
<p><a target="_blank" rel="noopener" href="https://ts.nodejs.cn/docs/handbook/type-compatibility.html">https://ts.nodejs.cn/docs/handbook/type-compatibility.html</a></p>
<p><a target="_blank" rel="noopener" href="https://cntofu.com/book/2/doc/handbook/JSX.md">https://cntofu.com/book/2/doc/handbook/JSX.md</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/620451796?utm_id=0">https://zhuanlan.zhihu.com/p/620451796?utm_id=0</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/626110313">https://zhuanlan.zhihu.com/p/626110313</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/58123993?utm_id=0">https://zhuanlan.zhihu.com/p/58123993?utm_id=0</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/384172236">https://zhuanlan.zhihu.com/p/384172236</a></p>
<p>泛型：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_64210950/article/details/128088432">https://blog.csdn.net/weixin_64210950/article/details/128088432</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hellolol/p/13371902.html">https://www.cnblogs.com/hellolol/p/13371902.html</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MjM5MDA2MTI1MA==&mid=2649133674&idx=2&sn=43fc5573ff99565fc127d0807423e9a1&chksm=be58b5c7892f3cd1852ec7e1fbdea1bc33bbae104f70c2f513a637f338453711e2e8c653c963&scene=27">https://mp.weixin.qq.com/s?__biz=MjM5MDA2MTI1MA==&amp;mid=2649133674&amp;idx=2&amp;sn=43fc5573ff99565fc127d0807423e9a1&amp;chksm=be58b5c7892f3cd1852ec7e1fbdea1bc33bbae104f70c2f513a637f338453711e2e8c653c963&amp;scene=27</a></p>
<p><a target="_blank" rel="noopener" href="https://ts.xcatliu.com/basics/union-types.html">https://ts.xcatliu.com/basics/union-types.html</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/wangdoc/typescript-tutorial">https://github.com/wangdoc/typescript-tutorial</a></p>
<p><a target="_blank" rel="noopener" href="https://wangdoc.com/typescript/operator#is-%E8%BF%90%E7%AE%97%E7%AC%A6">https://wangdoc.com/typescript/operator#is-%E8%BF%90%E7%AE%97%E7%AC%A6</a></p>
<p>wangdoc：泛型和模块（包含模块）以下没有处理</p>
<p>TypeScript 是一门静态类型、强类型的编程语言，它是 JavaScript 的超集，扩展了 JavaScript 的功能，引入了静态类型检查和新的语法特性。TypeScript 与 <a target="_blank" rel="noopener" href="https://tc39.es/process-document/">ECMAScript 标准</a>同步发展，进入 Stage 3 阶段的语法都会被实现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TS = JS + 类型</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>关于 TypeScript 类型的强弱，有一些争论，官网却宣传为 strongly typed，但作为 JavaScript 的超集，TypeScript 需要兼容所有 JavaScript 特性，包括弱类型中的允许隐式类型转换，所以它是一种弱类型语言。当然，通过编译选项，配置类型检查的严格程度，借助 typescript-eslint 代码检查，开启 <a target="_blank" rel="noopener" href="https://typescript-eslint.io/rules/strict-boolean-expressions/">strict-boolean-expressions</a> 和 <a target="_blank" rel="noopener" href="https://typescript-eslint.io/rules/restrict-plus-operands/">restrict-plus-operands</a>，在分支条件判断中强制使用布尔类型的值，加号时两者必须同为数字或同位字符串。</p>
<h2 id="类型的动静态和强弱"><a href="#类型的动静态和强弱" class="headerlink" title="类型的动静态和强弱"></a>类型的动静态和强弱</h2><h3 id="类型动静态"><a href="#类型动静态" class="headerlink" title="类型动静态"></a>类型动静态</h3><p>类型动静态指的是类型的检查时机，类型检查是在编译时还是运行时进行，运行时检查被称为动态类型，编译时检查被称为静态类型。</p>
<ul>
<li>动态类型</li>
</ul>
<p>动态类型是指在程序的执行过程中，变量的类型可以动态地改变（通过变量的赋值、对象属性的加减等操作），变量的类型是在运行时确定，同一个变量可以在不同的时间点具有不同的类型。</p>
<p>动态类型具有灵活、简洁、快速迭代的优点。动态类型允许变量在运行时具有不同的类型，不需要进行类型转换或声明新的变量，这使得处理不同类型的数据更加灵活和方便。不需要显式地声明变量的类型，编码过程更加简单直观。不需要等待编译过程，可以更快地进行开发和迭代，可以立即测试和验证代码的功能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = <span class="number">1</span> <span class="comment">// number</span></span><br><span class="line">foo = <span class="string">&#x27;1&#x27;</span> <span class="comment">// string</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">delete</span> foo.<span class="property">a</span>;</span><br><span class="line">foo.<span class="property">b</span> = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>动态类型语言也有运行时类型错误、工具支持不足、可读性和可维护性差、性能问题的缺点。在编写动态类型语言的代码时，需要更加注意类型、代码风格、性能等问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="string">&#x27;3.1415926&#x27;</span></span><br><span class="line">num.<span class="title function_">toFixed</span>(<span class="number">1</span>) <span class="comment">// Uncaught TypeError: num.toFixed is not a function</span></span><br></pre></td></tr></table></figure>

<ul>
<li>静态类型</li>
</ul>
<p>静态类型是指在编译时变量、函数参数和返回值的类型就被确定，在声明时必须指定其类型（类型注解），并且不能改变，编译器会在编译时检查类型的一致性，以确保变量的使用符合类型规定。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">foo</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">foo = <span class="string">&#x27;1&#x27;</span> <span class="comment">// Type &#x27;string&#x27; is not assignable to type &#x27;number&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">delete</span> foo.<span class="property">a</span> <span class="comment">// The operand of a &#x27;delete&#x27; operator must be optional.</span></span><br><span class="line">foo.<span class="property">b</span> = <span class="number">2</span> <span class="comment">// Property &#x27;b&#x27; does not exist on type &#x27;&#123; a: number &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>静态类型有编译时类型检查、更好的工具支持、代码的可读性和可维护性的优点。静态类型在编译时进行类型检查，可以在代码执行之前捕获类型错误，这可以帮助开发人员在代码运行之前发现和修复潜在的类型错误，减少运行时错误的发生。静态类型语言通常具有更强大的开发工具支持，如接口提示、代码补全、自动重构、静态分析等。静态类型语言要求在变量声明时显式指定类型，这使得代码更易于理解和维护。类型信息可以作为文档，帮助开发人员理解代码的意图和预期的数据结构。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">fibonacci</span>: <span class="built_in">number</span>[] = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">fibonacci.<span class="title function_">push</span>(<span class="string">&#x27;8&#x27;</span>) <span class="comment">// 编译时类型检查</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用第三方框架、库、组件时接口提示</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">AxiosInstance</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line"><span class="comment">// button 的类型为 HTMLElement | null，编辑器会自动补全 ?，处理 button 不存在情况</span></span><br><span class="line">button?.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">border</span> = <span class="string">&#x27;1px red solid&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>一些动态类型语言配合工具也能进行类型的静态检查，比如 Python 3.5 中支持了类型标注，配合静态类型检查工具（如 mypy）在开发过程中进行类型检查。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello &#x27;</span> + name</span><br></pre></td></tr></table></figure>

<p>静态类型语言需要更多的类型注解和声明，这使得编码过程稍微繁琐一些。</p>
<h3 id="类型强弱"><a href="#类型强弱" class="headerlink" title="类型强弱"></a>类型强弱</h3><p>类型强弱指的是类型检查的严格程度，弱类型允许隐私类型转换，强类型不允许。</p>
<p>注：隐式类型转换（自动类型转换）是指在表达式中，当不同类型的值进行操作时，编程语言自动进行类型转换以使操作能够进行，与之相对应的是显式类型转换。</p>
<ul>
<li>强类型</li>
</ul>
<p>强类型是指在编译或运行时严格检查类型，变量的类型是严格的，不允许隐式的类型转换，需要显式地进行类型转换。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="string">&#x27;2&#x27;</span></span><br><span class="line">c = a + b <span class="comment"># TypeError，强类型的 Python 不允许隐式类型转换，需要显示转换 a + int(b)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>弱类型</li>
</ul>
<p>弱类型中，变量的类型可以隐式地进行类型转换，根据上下文自动转换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line"><span class="comment">// 弱类型的 JavaScript 允许隐私类型转换</span></span><br><span class="line"><span class="keyword">if</span> (foo) &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>类型动静态和强弱区别</li>
</ul>
<p>类型动静态和类型强弱的区别在于前者强调的是类型检查发生的时机（是否允许动态类型改变），后者强调的是类型检查的严格程度（是否允许隐式类型转换）。以 Python 为例，Python 是动态类型强类型语言，它允许运行时改变变量的类型，但不允许隐式类型转换。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">a = <span class="number">1</span>  <span class="comment"># 不会报错，动态类型允许类型动态改变</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="string">&#x27;2&#x27;</span></span><br><span class="line">a &lt; b <span class="comment"># TypeError，强类型不允许隐式类型转换，需要显示转换 a &lt; int(b)</span></span><br></pre></td></tr></table></figure>

<p>隐私类型转换会在表达式计算时对变量类型进行转换但不改变变量本身的类型，而动态类型改变是在赋值语句中永远的改变变量类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(a), <span class="built_in">isinstance</span>(a, <span class="built_in">int</span>)) <span class="comment"># &lt;class &#x27;int&#x27;&gt; True, 动态类型改变永远改变变量本身的类型</span></span><br><span class="line">b = <span class="string">&#x27;2&#x27;</span></span><br><span class="line">a &lt; <span class="built_in">int</span>(b)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(b), <span class="built_in">isinstance</span>(b, <span class="built_in">str</span>)) <span class="comment"># &lt;class &#x27;str&#x27;&gt; True, 显式类型转换并不改变变量本身的类型</span></span><br></pre></td></tr></table></figure>

<h2 id="TypeScript-运行和调试"><a href="#TypeScript-运行和调试" class="headerlink" title="TypeScript 运行和调试"></a>TypeScript 运行和调试</h2><p>TypeScript 可将类型擦除后转为 JavaScript 在浏览器或 Node.js 中运行，也可在支持其运行的环境中直接运行，而无需编译。如果只是做一些实验性的测试，还可在 <a target="_blank" rel="noopener" href="https://www.typescriptlang.org/play">TypeScript Playground</a>，或第三方在线编辑器 <a target="_blank" rel="noopener" href="https://playcode.io/">playcode</a>、<a target="_blank" rel="noopener" href="https://stackblitz.com/">stackblitz</a>、<a target="_blank" rel="noopener" href="https://codesandbox.io/">codesandbox</a> 中运行，这些工具会在后台自动处理其到 JavaScript 的转换。</p>
<h3 id="TypeScript-运行"><a href="#TypeScript-运行" class="headerlink" title="TypeScript 运行"></a>TypeScript 运行</h3><ul>
<li>类型擦除</li>
</ul>
<p>将 TypeScript 编译为 JavaScript 的过程叫类型擦除。常见的类型擦除工具有 <a target="_blank" rel="noopener" href="https://babeljs.io/docs/babel-preset-typescript">babel</a>、TypeScript 官方编译器 <a target="_blank" rel="noopener" href="https://github.com/microsoft/TypeScript">tsc</a>、<a target="_blank" rel="noopener" href="https://github.com/evanw/esbuild">esbuild</a>、<a target="_blank" rel="noopener" href="https://github.com/swc-project/swc">swc</a>。其中，tsc 和 babel 由 JS 实现，而且 tsc 还会检查 TS 语法，编译速度不快，而 esbuild 和 SWC 则由 Go 和 Rust 实现，且不检查 TS 语法（类型都要擦除了，检查也没意义），编译速度很快。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tsc</span></span><br><span class="line"><span class="comment"># 全局安装</span></span><br><span class="line">npm i -g typescript</span><br><span class="line">tsc 1.ts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部安装</span></span><br><span class="line">npm init</span><br><span class="line">npm install typescript -S</span><br><span class="line">npx tsc --init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果只是临时使用，也可以直接使用 npx</span></span><br><span class="line">npx -p typescript tsc <span class="comment"># -p 参数指必须先下载完对应包，再执行后面的命令</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># babel</span></span><br><span class="line">npm i @babel/core @babel/cli @babel/preset-typescript <span class="comment"># npm 5.0 后默认使用 --save-dev 参数</span></span><br><span class="line">npx babel --presets @babel/preset-typescript 1.ts</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># esbuild</span></span><br><span class="line">npm i -g esbuild</span><br><span class="line">esbuild 1.ts &gt; 1.js</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SWC</span></span><br><span class="line">npm i -g @SWC/cli @SWC/core</span><br><span class="line">SWC 1.ts -o 1.js</span><br></pre></td></tr></table></figure>

<p>TypeScript 交付给不同运行目标的流程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypesSript (Deno) --(类型擦除)--&gt; ES6 (Node.js 12+、Chrome 100，支持 98%) --(转译)--&gt; ES5 (Node.js 10-、IE11-) --(打包)--&gt; 单文件</span><br></pre></td></tr></table></figure>

<p>在实际项目中，前端脚手架工具都已内置 TS 编译器（Vite 内置 esbuild），可直接使用。</p>
<p>注：查看 ES6 支持情况 <a target="_blank" rel="noopener" href="https://kangax.github.io/compat-table/es6/">ECMAScript 6 compatibility table</a></p>
<ul>
<li>直接运行</li>
</ul>
<p>NodeJS 环境下可通过 <a target="_blank" rel="noopener" href="https://github.com/TypeStrong/ts-node">ts-node</a>、<a target="_blank" rel="noopener" href="https://github.com/swc-project/swc-node">swc-node</a>、<a target="_blank" rel="noopener" href="https://github.com/privatenumber/tsx">tsx</a> (tsx 是基于 esbuild 的，<a target="_blank" rel="noopener" href="https://github.com/esbuild-kit/esno">esno</a> 是 tsx 的 alias) 直接运行 TypeScript。ts-node 性能不好，可在开发中使用，但不建议在生产中使用，上生产就需要 <code>tsc</code> 为 JavaScript 后运行。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>:<span class="built_in">number</span> = <span class="number">1</span> + <span class="number">2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ts-node</span></span><br><span class="line"><span class="comment"># 全局安装</span></span><br><span class="line">npm install -g ts-node</span><br><span class="line"></span><br><span class="line">ts-node ./test.ts <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时使用</span></span><br><span class="line">npx ts-node test.ts <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不带任何参数，则会进入 REPL</span></span><br><span class="line">ts-node</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># swc-node</span></span><br><span class="line">node -r @swc-node/register test.ts <span class="comment"># 3</span></span><br></pre></td></tr></table></figure>

<p>除了 Node.JS 外，JavaScript 的运行环境还有 Deno 和 Bun，这两个原生支持 TypeScript。Deno 的底层 Rust 和 V8，可直接运行 TS，Rust 对 TS 进行类型擦除后再交给 V8 运行</p>
<h3 id="调试-TypeScript"><a href="#调试-TypeScript" class="headerlink" title="调试 TypeScript"></a>调试 TypeScript</h3><p>类型不同于值，可使用打印调试，VSCode 中通过鼠标移入来调试 TypeScript 类型，或者控制台中 ts-node 类型检查结果查看报错。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Name</span> = <span class="built_in">string</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Age</span> = <span class="built_in">number</span></span><br><span class="line"><span class="keyword">type</span> X = <span class="title class_">Name</span> &amp; <span class="title class_">Age</span> <span class="comment">// 鼠标移入 X 即可知道 X 的类型</span></span><br></pre></td></tr></table></figure>

<h2 id="TypeScript-类型系统"><a href="#TypeScript-类型系统" class="headerlink" title="TypeScript 类型系统"></a>TypeScript 类型系统</h2><p>TypeScript 类型包含了所有的 JavaScript 类型，还增加了 <code>void</code>、<code>never</code>、<code>unknown</code>、<code>any</code> 以及自定义类型（<code>interface</code>、<code>enum</code>、<code>Tuple</code>、对象类型、class 类型、字面量类型）。</p>
<p>以集合来思考 TypeScript 类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以集合来思考 TypeScript 类型 number、string、boolean、null、object</span></span><br><span class="line"><span class="comment">// | (或) 的关系</span></span><br><span class="line"><span class="keyword">type</span> <span class="built_in">number</span> = <span class="number">1</span> | <span class="number">1.1</span> | ... | <span class="number">2</span> | <span class="number">3</span> | ... <span class="comment">// number 类型表示所有数字值的集合</span></span><br><span class="line"><span class="keyword">type</span> <span class="built_in">string</span> = <span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;ab&#x27;</span> | ... <span class="comment">// string 类型表示所有字符串值的集合</span></span><br><span class="line"><span class="keyword">type</span> <span class="built_in">boolean</span> = <span class="literal">true</span> | <span class="literal">false</span> <span class="comment">// boolean 类型表示所有布尔值的集合</span></span><br><span class="line"><span class="keyword">type</span> <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// null 类型表示 null 值的集合（一个元素也是集合）</span></span><br><span class="line"><span class="keyword">type</span> <span class="built_in">object</span> = &#123;&#125; | <span class="title class_">Array</span>&lt;<span class="built_in">any</span>&gt; | <span class="title class_">Function</span> | <span class="title class_">String</span> | <span class="title class_">Number</span> | <span class="title class_">Boolean</span> | <span class="title class_">RegExp</span> | <span class="title class_">Object</span> |... <span class="comment">// &#123;&#125; 普通对象</span></span><br></pre></td></tr></table></figure>

<p>TypeScript 的数据类型不同于 JavaScript 数据类型，JavaScript 数据类型指的是值&#x2F;数据的的分类，用来描述值&#x2F;数据的属性和操作，例如 <code>number</code> 类型的数据有 <code>toFixed</code> 属性，TypeScript 数据类型指的值的集合，用来描述变量、参数、返回值可以接收的值的范围（或形状），例如布尔类型的取值范围为 <code>true</code> 和 <code>false</code>。前者用于在运行时检查值的分类，后者在编译时检查值的取值范围。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript 数据类型</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;a&#x27;</span> <span class="comment">// &#x27;a&#x27; 的数据类型是 string</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">1.222</span> <span class="comment">// number</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">false</span> <span class="comment">// boolean</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span> <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> num = <span class="number">3.1415926</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> num === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">  num.<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypeScript 数据类型</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">bar</span>: <span class="built_in">boolean</span> = <span class="literal">false</span> <span class="comment">// bar 的值只能从 true | false 集合中取</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> num = <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> | <span class="number">4</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">foo</span>: num = <span class="number">1</span> <span class="comment">// foo 的值只能从 1 | 2 | 3 | 4 集合中取</span></span><br></pre></td></tr></table></figure>

<h3 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h3><p>基本类型即 JavaScript 中的 8 种类型，包括 7 种原始类型和 1 种对象类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">null、undefined (JavaScript 有两个空类型)</span><br><span class="line">string、number、boolean</span><br><span class="line">bigint、symbol</span><br><span class="line">object（含 Array、Function、Date、String、Number、Boolean...）</span><br></pre></td></tr></table></figure>

<p>注意：<code>string</code>、<code>number</code>、<code>boolean</code> 是基本类型（具体上是原始类型），<code>String</code>、<code>Number</code>、<code>Boolean</code> 是 <code>interface</code>，是包装对象的类型。包装对象是系统内部的暗箱操作，JavaScript 和 TypeScript 中都不要在代码中使用 <code>Stirng</code>、<code>Number</code>、<code>Boolean</code>，这是 JavaScript 引擎用的。另外，<code>object</code> 是基本类型，<code>Object</code> 是 <code>interface</code>，<code>object</code> 类型更加具体，只表示对象类型，<code>Object</code> 类型包含了更广泛的值范围，含包装类型，等同于 <code>any</code>。</p>
<h3 id="any、unknown、never"><a href="#any、unknown、never" class="headerlink" title="any、unknown、never"></a>any、unknown、never</h3><ul>
<li><code>any</code></li>
</ul>
<p><code>any</code> 是所有类型，即全集。其相当于类型系统的后门，一但使用了它，类型检查便会失效，类型安全得不到保障。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"><span class="comment">// ∪ 表示并集，不能理解为或（|）其中之一 </span></span><br><span class="line"><span class="keyword">type</span> <span class="built_in">any</span> = <span class="built_in">number</span> ∪ <span class="built_in">string</span> ∪ <span class="built_in">boolean</span> ∪ <span class="literal">undefined</span> ∪ <span class="literal">null</span> ∪ <span class="built_in">object</span> ∪ ...</span><br></pre></td></tr></table></figure>

<p><code>any</code> 还会污染其他变量，使得其它变量失去类型检查。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">x</span>: <span class="built_in">any</span> = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">y  = x <span class="comment">// 不报错</span></span><br><span class="line">y * <span class="number">123</span> <span class="comment">// 不报错</span></span><br><span class="line">y.<span class="title function_">toFixed</span>() <span class="comment">// 不报错</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>unknown</code></li>
</ul>
<p><code>unknown</code> 是未知类型，即未知集，也称为占位类型，需要后面确定类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"><span class="keyword">type</span> <span class="built_in">unknown</span> = <span class="built_in">number</span> | <span class="built_in">string</span> | <span class="built_in">boolean</span> | <span class="literal">undefined</span> | <span class="literal">null</span> | <span class="built_in">object</span> | ...</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="built_in">unknown</span> = <span class="number">1</span></span><br><span class="line">a.<span class="title function_">toFixed</span>() <span class="comment">// 报异常 &#x27;a&#x27; is of type &#x27;unknown&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>unknown</code> 类型是一个安全类型，用的时候需断言为具体类型。适合接收动态数据，当从外部源（例如用户输入、API 响应等）接收数据时，可能无法确定数据的确切类型。此时可以将数据的类型声明为 <code>unknown</code>，然后根据需要进行类型检查和转换。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="built_in">unknown</span> = <span class="number">1</span>; <span class="comment">// 分号不能不写，否则小括号上移将当函数调用</span></span><br><span class="line">(a <span class="keyword">as</span> <span class="built_in">number</span>).<span class="title function_">toFixed</span>()</span><br></pre></td></tr></table></figure>

<p>注：<code>any</code> 与 <code>unknown</code> 区别，<code>any</code> 是所有类型的集合（并集，不是之一），<code>unknown</code> 是所有类型的联合（之一）。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// any 可以使用所有类型的方法</span></span><br><span class="line">  <span class="comment">// any 是所有类型，而不是所有类型中一个</span></span><br><span class="line">  a.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">  a.<span class="title function_">join</span>()</span><br><span class="line">  a.<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: <span class="built_in">unknown</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// unknown 类型可以收窄为任何类型，所以 unknown 是所有类型的联合 string | Date | number...，用时也必须要收窄</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a <span class="keyword">instanceof</span> <span class="title class_">Date</span>) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>never</code></li>
</ul>
<p><code>never</code> 是空类型，即空集，一个不包括任何元素的集合，是值永远不会出现的一种类型。常用来表示函数空返回（例如抛出异常或进入无限循环）和类型收窄中完整性检查。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throwError</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Color</span> = <span class="string">&#x27;red&#x27;</span> | <span class="string">&#x27;green&#x27;</span> | <span class="string">&#x27;blue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getColorValue</span>(<span class="params">color: Color</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (color) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;red&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;#FF0000&#x27;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;green&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;#00FF00&#x27;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;blue&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;#0000FF&#x27;</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// TypeScript 会推断这里的返回类型为 never，因为所有可能的情况都已经被处理</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">exhaustiveCheck</span>: <span class="built_in">never</span> = color</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Unhandled color: <span class="subst">$&#123;exhaustiveCheck&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：<code>underfined</code> 也是一个值，不能使用 <code>never</code> 表示。</p>
<h3 id="enum-类型"><a href="#enum-类型" class="headerlink" title="enum 类型"></a>enum 类型</h3><p>枚举用于描述具名值的集合。通过定义一组有名字的常量来表示一组相关的值，不但语义化清晰地表示代码中的意图，避免了魔法字符串，而且还可以反向映射。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">  todo,</span><br><span class="line">  done,</span><br><span class="line">  archived</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">state</span>: <span class="title class_">Status</span> = <span class="number">0</span> <span class="comment">// 枚举类型 Status 会被类型擦除掉</span></span><br><span class="line">state = <span class="title class_">Status</span>.<span class="property">todo</span> <span class="comment">// Status.todo 不会枚被擦除，但会被替换成 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span><br></pre></td></tr></table></figure>

<p>默认情况下，枚举成员值是从 <code>0</code> 开始递增的，但也可以指定特定的值。成员值只允许是 <code>number</code> 或 <code>string</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">  todo = <span class="number">1</span>,</span><br><span class="line">  done = <span class="number">2</span>,</span><br><span class="line">  archived =<span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Permission</span> &#123;</span><br><span class="line">  <span class="title class_">None</span> = <span class="number">0</span>, <span class="comment">// 0000</span></span><br><span class="line">  <span class="title class_">Read</span> = <span class="number">1</span> &lt;&lt; <span class="number">0</span>, <span class="comment">// 0001，左移 0 位</span></span><br><span class="line">  <span class="title class_">Write</span> = <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">// 0010，左移 1 位</span></span><br><span class="line">  <span class="title class_">Delete</span> = <span class="number">1</span> &lt;&lt; <span class="number">2</span>, <span class="comment">// 0100，左移 2 位</span></span><br><span class="line">  <span class="title class_">Manage</span> = <span class="title class_">Read</span> | <span class="title class_">Write</span> | <span class="title class_">Delete</span> <span class="comment">// 0111</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">permission</span>: <span class="title class_">Permission</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">permission</span>: <span class="title class_">Permission</span>.<span class="property">Read</span> | <span class="title class_">Permission</span>.<span class="property">Write</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 用户的权限和所检查权限做与运算，结果依然等于所检查权限，则说明用户拥有所检查权限</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hasPermission</span>(<span class="params">permission: Permission, checkPermission: Permission</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> (permission &amp; checkPermission) === checkPermission;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">hasPermission</span>(user.<span class="property">permission</span>, <span class="title class_">Permission</span>.<span class="property">Write</span>)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;拥有写权限&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">hasPermission</span>(user.<span class="property">permission</span>, <span class="title class_">Permission</span>.<span class="property">Manage</span>)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;拥有管理权限&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>除了语义化值外，<code>enum</code> 还常用来做格式化。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过反向映射，将值映射到名做格式化</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">  <span class="string">&#x27;未完成&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;已完成&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;已归档&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Status</span>[<span class="number">0</span>] <span class="comment">// 未完成</span></span><br></pre></td></tr></table></figure>

<h3 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h3><p><code>interface</code> 接口，用来定义对象的类型，描述对象的属性和方法，是面向对象中的概念。JavaScript 是一个多范式的编程语言，包括面向对象，TypeScript 添加 <code>interface</code> 是为了支持面向对象。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义普通对象类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">b</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用索引签名批量描述</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  [<span class="attr">k</span>: <span class="built_in">string</span>]: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义数组类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Points</span> <span class="keyword">extends</span> <span class="title class_">Array</span>&lt;<span class="title class_">Point</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Points</span> = <span class="title class_">Array</span>&lt;<span class="title class_">Point</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义函数类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Fn</span> &#123;</span><br><span class="line">  (<span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span>): <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">f</span>: <span class="title class_">Fn</span> = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带属性的函数</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Fn</span> &#123;</span><br><span class="line">  (<span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span>): <span class="built_in">number</span></span><br><span class="line">  <span class="attr">prop</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">f</span>: <span class="title class_">Fn</span> = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y</span><br><span class="line">f.<span class="property">prop</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义内置对象类型</span></span><br><span class="line"><span class="comment">// 以 Date 为例</span></span><br><span class="line"><span class="keyword">interface</span> D <span class="keyword">extends</span> <span class="title class_">Date</span> &#123;</span><br><span class="line">  <span class="comment">// aa: string // 如果扩展了 Date，则需要重新定义构造函数，不像函数可以后加属性 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">d</span>: D = <span class="keyword">new</span> <span class="title class_">Date</span>() </span><br></pre></td></tr></table></figure>

<p><code>interface</code> 多个继承。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> X &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Y &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 描述数组，添加更多的属性</span></span><br><span class="line"><span class="keyword">interface</span> A <span class="keyword">extends</span> X, Y &#123;</span><br><span class="line">  <span class="attr">sex</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>interface 和 type 区别</li>
</ul>
<p><code>interface</code> 是类型声明，<code>type</code> 是类型别名，<code>interface</code> 只描述对象类型，不能描述原始类型，<code>type</code> 则可描述所有类型（包括 <code>interface</code>）。<code>interface</code> 会自动合扩展类型（因为描述的是对象），<code>type</code> 不可重新赋值。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// type 是类型别名</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="built_in">string</span></span><br><span class="line"><span class="keyword">type</span> B = A <span class="comment">// 如果 type 是类型声明，B 应该是 A，但 B 也是 string 的别名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// interface 是类型声明</span></span><br><span class="line"><span class="keyword">interface</span> A <span class="keyword">extends</span> <span class="title class_">Date</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> B = A <span class="comment">// B 就是 A</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// interface 会自动合并扩展类型</span></span><br><span class="line"><span class="keyword">interface</span> X &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> X &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: X = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aa&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对外 API 尽量用 <code>interface</code>，方便调用者扩展，对内 API 尽量用 <code>type</code>，防止被扩展。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展 Axios</span></span><br><span class="line"><span class="comment">// 如果 Axios 内部 `AxiosRequestConfig` 由 `type` 定义，则无扩展的可能</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;axios&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">    autoLoading?: <span class="built_in">boolean</span></span><br><span class="line">    mock?: <span class="built_in">string</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展 String</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">global</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="title function_">padZero</span>(<span class="attr">length</span>: <span class="built_in">number</span>): <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="void"><a href="#void" class="headerlink" title="void"></a>void</h3><p><code>void</code> 表示函数没有返回值，如果直接写在函数中，则会严格检查，如果使用 <code>type</code> 别名，则不会严格检查，允许 <code>return</code>，但用不了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明和表达式中会严格检查 void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> <span class="comment">// 提示类型错误</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> <span class="comment">// 提示类型错误</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Fn</span> = <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不严格检查，允许 return</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">foo</span>: <span class="title class_">Fn</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> num = <span class="title function_">foo</span>()</span><br><span class="line"><span class="comment">// 但是用不了</span></span><br><span class="line">num.<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure>

<h3 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对象类型中使用索引签名，映射类型及修饰符。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 索引签名</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Hash</span> = &#123;</span><br><span class="line">  [<span class="attr">k</span>: <span class="built_in">string</span>]: <span class="built_in">unknown</span></span><br><span class="line">  <span class="attr">length</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">List</span> = &#123;</span><br><span class="line">  [<span class="attr">k</span>: <span class="built_in">number</span>]: <span class="built_in">unknown</span></span><br><span class="line">  <span class="attr">length</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 映射类型</span></span><br><span class="line"><span class="comment">// 映射类型最常用还是在泛型中</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Hash</span> = &#123;</span><br><span class="line">  [k <span class="keyword">in</span> <span class="built_in">string</span>]: <span class="built_in">unknown</span></span><br><span class="line">  <span class="comment">// length: number // 不能声明 length 属性，否则会报 A mapped type may not declare properties or methods</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">List</span> = &#123;</span><br><span class="line">  [k <span class="keyword">in</span> <span class="built_in">number</span>]: <span class="built_in">unknown</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ? 可选，readonly 只读</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  age?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：普通对象的类型能够被自动推断出来，<code>import</code> 的 JSON 文件，类型也能被推断。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">b</span>: &#123;</span><br><span class="line">      <span class="attr">c</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">b</span>.<span class="property">c</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ObjType</span> = <span class="keyword">typeof</span> obj</span><br></pre></td></tr></table></figure>

<h3 id="class-类型"><a href="#class-类型" class="headerlink" title="class 类型"></a>class 类型</h3><p>class 作为一种值，其本身也是一种类型，是实例的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">p</span>: <span class="title class_">Person</span> = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;tracy&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="字面量类型"><a href="#字面量类型" class="headerlink" title="字面量类型"></a>字面量类型</h3><p>字面量类型是一种特殊的类型，它表示一个具体的值，而不仅仅是一个范围。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyString</span> = <span class="string">&#x27;hello&#x27;</span> <span class="comment">// 字符串字面量类型。TypeScript 中的类型指的是值的集合，可以包含很多值，也可以只包含一个值</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">MyNumber</span> = <span class="number">42</span> <span class="comment">// 数字字面量类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">MyBoolean</span> = <span class="literal">true</span> <span class="comment">// 布尔字面量类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">MyObject</span> = &#123; <span class="attr">name</span>: <span class="string">&#x27;tracy&#x27;</span>, <span class="attr">age</span>: <span class="number">23</span> &#125; <span class="comment">// 对象字面量类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">MyArray</span> = [<span class="string">&#x27;tracy&#x27;</span>, <span class="number">23</span>] <span class="comment">// 数组字面量类型</span></span><br></pre></td></tr></table></figure>

<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p><code>type</code> 类型别名（Type Aliases），用来给其他类型取个名字（用作分治或复用）。<code>type</code> 基本上是万能的，可以用来描述任何类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Name</span> = <span class="built_in">string</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FalseLike</span> = <span class="number">0</span> | <span class="string">&#x27;&#x27;</span> | <span class="literal">null</span> | <span class="literal">undefined</span> | <span class="literal">false</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Point</span> = &#123;<span class="attr">x</span>: <span class="built_in">number</span>; <span class="attr">y</span>: <span class="built_in">number</span>&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Points</span> = <span class="title class_">Point</span>[]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Line</span> = [<span class="title class_">Point</span>, <span class="title class_">Point</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Circle</span> = &#123;<span class="attr">center</span>: <span class="title class_">Point</span>; <span class="attr">radius</span>: <span class="built_in">number</span>&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Fn</span> = <span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"><span class="comment">// 带有属性的函数的类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FnWithProps</span> = &#123;</span><br><span class="line">  (<span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span>): <span class="built_in">number</span></span><br><span class="line">  <span class="attr">prop</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>type 继承</li>
</ul>
<p><code>type</code> 通过 <code>&amp;</code> 实现继承。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> B = &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125; &amp; A</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">b</span>: B = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aa&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">23</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：<code>type</code> 是不可变的，这有利于静态类型检查时，确保类型的一致性，但是也意味着 <code>type</code> 声明的类型无法修改，无法扩展。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = <span class="built_in">string</span></span><br><span class="line">A = <span class="built_in">number</span> <span class="comment">// 不能将类型 number 分配给类型 string</span></span><br></pre></td></tr></table></figure>

<h3 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h3><p>联合类型（Union Types）允许一个值属于多个可能的类型<strong>之一</strong>（每个成员类型都是独立的，不像并集，集合做合并，包含集合中所有的元素）。使用竖线 <code>|</code> 来定义联合类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="variable constant_">A1</span> = <span class="built_in">number</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">B1</span> = <span class="built_in">string</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">C1</span> = <span class="variable constant_">A1</span> | <span class="variable constant_">B1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">c1</span>: <span class="variable constant_">C1</span> = <span class="number">42</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="variable constant_">A2</span> = &#123;<span class="attr">name</span>: <span class="built_in">string</span>&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">B2</span> = &#123;<span class="attr">age</span>: <span class="built_in">number</span>&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">C2</span> = <span class="variable constant_">A2</span> | <span class="variable constant_">B2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：这里类型并没有变小，name、age 可选一个，如果 | 改为 &amp; 则不一样</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">c2</span>: <span class="variable constant_">C2</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JSON 是一个树形结构</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">JSON</span>Value = </span><br><span class="line">  | <span class="built_in">string</span></span><br><span class="line">  | <span class="built_in">number</span></span><br><span class="line">  | <span class="literal">null</span></span><br><span class="line">  | <span class="built_in">boolean</span></span><br><span class="line">  | <span class="title class_">JSON</span>Value[]</span><br><span class="line">  | &#123; [<span class="attr">k</span>: <span class="built_in">string</span>]: <span class="title class_">JSON</span>Value &#125; <span class="comment">// 不能用 Record&lt;string, JSONValue&gt;，Record 是一个工具函数，会引发递归</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printJSON</span>(<span class="params">data: JSONValue, indent: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> data === <span class="string">&#x27;number&#x27;</span> || <span class="keyword">typeof</span> data === <span class="string">&#x27;boolean&#x27;</span> || data === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(indent + data);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(data)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(indent + <span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">    data.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">printJSON</span>(item, indent + <span class="string">&#x27;  &#x27;</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(indent + <span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(indent + <span class="string">&#x27;&#123;&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(indent + <span class="string">&#x27;  &#x27;</span> + key + <span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">      <span class="title function_">printJSON</span>(data[key], indent + <span class="string">&#x27;    &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(indent + <span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>联合类型在使用时需要区分类型，即类型收窄，不收窄的话，只能使用公共方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">a: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a.<span class="property">length</span> <span class="comment">// Property &#x27;length&#x27; does not exist on type &#x27;number&#x27;.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">a: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    a.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>类型收窄（Narrowing）</li>
</ul>
<p>将不精确类型变为精确类型的过程称为类型收窄。常用的类型收窄方法（类型守卫&#x2F;类型保护 Type Guard）有 <code>typeof</code>、<code>instanceof</code>、<code>in</code>、<code>Array.isArray</code>、判空、类型谓词、可辨别联合。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// typeof 收窄</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">f1</span> = (<span class="params">a: <span class="built_in">number</span> | <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    a.<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    a.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// instanceof 收窄</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: <span class="built_in">Date</span> | <span class="built_in">String</span> | <span class="built_in">Date</span>[]</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a <span class="keyword">instanceof</span> <span class="title class_">Date</span>) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in 收窄</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Animal</span> = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: Person | Animal</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> a) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&#x27;x&#x27;</span> <span class="keyword">in</span> a) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真值收窄</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a?: <span class="built_in">string</span>[]</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// a 存在的话，必然是 string[]，否则就只能是 undefined</span></span><br><span class="line">  <span class="keyword">if</span> (a) &#123;</span><br><span class="line">    a <span class="comment">// string[]</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    a <span class="comment">// undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等值收窄</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: <span class="built_in">string</span> | <span class="built_in">number</span>, b: <span class="built_in">string</span> | <span class="built_in">boolean</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 如果 a 与 b 相等，TS 就认为类型也相等</span></span><br><span class="line">  <span class="keyword">if</span> (a === b) &#123;</span><br><span class="line">    a <span class="comment">// string</span></span><br><span class="line">    b <span class="comment">// string</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    a <span class="comment">// string | number</span></span><br><span class="line">    b <span class="comment">// string | boolean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 赋值收窄</span></span><br><span class="line"><span class="comment">// 通过赋值语句的右值，正确的收窄左值</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: <span class="built_in">string</span> | <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">  a = <span class="number">1</span></span><br><span class="line">  a <span class="comment">// 一定是 number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用类型谓词</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Rect</span> &#123;</span><br><span class="line">  <span class="attr">width</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="attr">center</span>: [<span class="built_in">number</span>, <span class="built_in">number</span>]</span><br><span class="line">  <span class="attr">radius</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能使用 boolean 代替 x is Rect，否则 TS 不知道是不是 Rect</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isRect</span>(<span class="params">x: Rect | Circle</span>): x is <span class="title class_">Rect</span> &#123;</span><br><span class="line">  <span class="comment">// 判断逻辑可自由实现</span></span><br><span class="line">  <span class="comment">// return (x as Rect).width !== undefined</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;height&#x27;</span> <span class="keyword">in</span> x &amp;&amp; <span class="string">&#x27;width&#x27;</span> <span class="keyword">in</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isCircle</span>(<span class="params">x: Rect | Circle</span>): x is <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;center&#x27;</span> <span class="keyword">in</span> x &amp;&amp; <span class="string">&#x27;radius&#x27;</span> <span class="keyword">in</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: Rect | Circle</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRect</span>(a)) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isCircle</span>(a)) &#123;</span><br><span class="line">    a</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义类型谓词函数的类型不能注解在等号的左边</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">isRect</span>: <span class="function">(<span class="params">x: Rect | Circle</span>) =&gt;</span> x is <span class="title class_">Rect</span> = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;height&#x27;</span> <span class="keyword">in</span> x &amp;&amp; <span class="string">&#x27;width&#x27;</span> <span class="keyword">in</span> x</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这样才对</span></span><br><span class="line"><span class="keyword">const</span> isRect = (<span class="attr">x</span>: <span class="title class_">Rect</span> | <span class="title class_">Circle</span>): x is <span class="title class_">Rect</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;height&#x27;</span> <span class="keyword">in</span> x &amp;&amp; <span class="string">&#x27;width&#x27;</span> <span class="keyword">in</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当联合类型中的每个类型，都包含了一个共同的字面量类型的属性（例如，下面例子中的 <code>kind</code>），TypeScript 就会认为这是一个可辨别联合（discriminated union），然后可以将具体成员的类型进行收窄。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可辨别联合</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;circle&#x27;</span></span><br><span class="line">  <span class="attr">radius</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Square</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;square&#x27;</span></span><br><span class="line">  <span class="attr">sideLength</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Shape</span> = <span class="title class_">Circle</span> | <span class="title class_">Square</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getArea</span>(<span class="params">shape: Shape</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (shape.<span class="property">kind</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;circle&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="property">PI</span> * shape.<span class="property">radius</span> ** <span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;square&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> shape.<span class="property">sideLength</span> ** <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 断言</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;circle&#x27;</span></span><br><span class="line">  <span class="attr">center</span>: [<span class="built_in">number</span>, <span class="built_in">number</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Square</span> &#123;</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;square&#x27;</span></span><br><span class="line">  <span class="attr">sideLength</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Shape</span> = <span class="title class_">Circle</span> | <span class="title class_">Square</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a: Shape</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// foo 在调用时一定会传入 Circle，则可将 a 强制断言为 Circle</span></span><br><span class="line">  (a <span class="keyword">as</span> <span class="title class_">Circle</span>).<span class="property">center</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(&#123;<span class="attr">kind</span>: <span class="string">&#x27;circle&#x27;</span>, <span class="attr">center</span>: [<span class="number">1</span>, <span class="number">2</span>]&#125;)</span><br></pre></td></tr></table></figure>

<p>注：<code>typeof</code>、<code>instanceof</code> 和 <code>in</code> 虽然是 JavaScript 运行时的操作符，但是 TypeScript 编译时也能理解，这三个操作符不能单独判断所有的类型，需配合使用。</p>
<h3 id="交叉类型"><a href="#交叉类型" class="headerlink" title="交叉类型"></a>交叉类型</h3><p>交叉类型（itersection types）是一种将多个类型合并为一个类型的方式。使用 <code>&amp;</code> 来定义交叉类型，再次强调，<code>&amp;</code> 是交集，但 <code>|</code> 不是并集。</p>
<p>对简单类型求交集，结果会是 <code>never</code>，所以交叉类型一般用在对象上。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = <span class="built_in">string</span> &amp; <span class="built_in">number</span> <span class="comment">// never</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 有左手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> 有右手的人 = &#123;</span><br><span class="line">  <span class="attr">right</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> C = 有左手的人 | 有右手的人 <span class="comment">// 可以只有左手，或右手，也可以两只手都有</span></span><br><span class="line"><span class="keyword">type</span> D = 有左手的人 &amp; 有右手的人 <span class="comment">// 两只手要有</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">person1</span>: C = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">person2</span>: D = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">  <span class="attr">right</span>: <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Colorful</span> &#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="attr">radius</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ColorfulCircle</span> = <span class="title class_">Colorful</span> &amp; <span class="title class_">Circle</span></span><br></pre></td></tr></table></figure>

<p>交叉类型可以用来实现继承。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">User</span> = <span class="title class_">Person</span> &amp; &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">u</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aa&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">  <span class="attr">email</span>: <span class="string">&#x27;xxxx@gmail.com&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：交叉类型时如果出现字段冲突，冲突字段也会求交集，导致整个类型不可用。求交继承，字段发生冲突，类型本身不会报错，只有在类型使用时才会报错，而如果是 <code>interface</code> <code>extends</code> 继承，字段冲突，会立马报错。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 冲突字段 id 求交变成 never，整个 User 类型不可用，报错信息只有在类型使用时才会提示</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">User</span> = <span class="title class_">Person</span> &amp; &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">u</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aa&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">  <span class="attr">email</span>: <span class="string">&#x27;xxxx@gmail.com&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 报错信息会在类型声明时立刻提示出来</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h2><p>类型注解（Type Annotations，也叫类型标注或类型签名）是指在代码中显式地为变量、函数参数、函数返回值、类等添加类型信息。通过类型标注，以便编译器在编译时进行类型检查，捕获类型相关的错误，并提供更好的代码提示和自动补全功能，另外，类型标注可以作为代码的文档，提供更清晰的代码说明和使用方式。类型标注可以提高代码的可读性和可维护性。</p>
<p>TypeScript 类型注解的方式是在标识符后面添加“冒号 + 类型”。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>在某些情况下类型标注可以省略，TypeScript 支持类型推断，编译器可以根据上下文推断出变量的类型，从而使代码更简洁。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span> <span class="comment">// a 的类型被推导为 number</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> z = <span class="title function_">add</span>(<span class="number">3</span>, <span class="number">4</span>) <span class="comment">// z 的类型被推导为 number</span></span><br><span class="line">z  = <span class="string">&#x27;&#x27;</span> <span class="comment">// 提示 Type &#x27;string&#x27; is not assignable to type &#x27;number&#x27;.</span></span><br></pre></td></tr></table></figure>

<h3 id="原始类型的类型注解"><a href="#原始类型的类型注解" class="headerlink" title="原始类型的类型注解"></a>原始类型的类型注解</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">n</span>: <span class="built_in">bigint</span> = <span class="number">100n</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">s</span>: <span class="built_in">symbol</span> = <span class="title class_">Symbol</span>(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s)</span><br></pre></td></tr></table></figure>

<p>需要注意的是，块级类型声明只在当前代码块有效。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">Num</span> = <span class="built_in">number</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">a1</span>: <span class="title class_">Num</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">a2</span>: <span class="title class_">Num</span> = <span class="number">2</span> <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<h3 id="对象的类型注解"><a href="#对象的类型注解" class="headerlink" title="对象的类型注解"></a>对象的类型注解</h3><p>对象包括普通对象（<code>Object</code>）、数组对象（<code>Array</code>）、函数对象（<code>Function</code>）、正则对象（<code>RegExp</code>）、日期对象（<code>Date</code>）…。<code>Object</code> 是其它所有对象的基类。</p>
<p>对象的类型描述可用 <code>class/constructor</code>，也可用 <code>type</code> 或 <code>interface</code>。</p>
<ul>
<li>普通对象</li>
</ul>
<p>普通对象一般使用字面量类型、索引签名（Index Signature）或 <code>Record</code> 泛型来描述。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;tracy&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">28</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>索引签名（<code>key</code> 的类型有 <code>string</code>、<code>number</code>、<code>symbol</code>）：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = &#123;</span><br><span class="line">  [<span class="attr">k</span>: <span class="built_in">string</span>]: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: A = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="number">123</span>: <span class="number">6</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = &#123;</span><br><span class="line">  [<span class="attr">k</span>: <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: A = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="number">123</span>: <span class="number">6</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = &#123;</span><br><span class="line">  [<span class="attr">k</span>: <span class="built_in">symbol</span>]: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> s = <span class="title class_">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: A = &#123;</span><br><span class="line">  [s]: <span class="number">1</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：JavaScript (运行时) 索引（属性）只能是 <code>string</code> 和 <code>symbol</code>，如果是 <code>number</code>，则会被转为 <code>string</code>。在使用点号 <code>.</code> 来访问对象的属性时，属性名必须是一个有效的标识符（由字母、数字、下划线和美元符号组成，不能以数字开头）。因此，当属性名是一个数字时，不能直接使用点号来访问对象的属性，而需要使用方括号 <code>[]</code> 来访问（里面是表达式），例如 <code>obj[1]</code>。另外，在定义对象的属性时，如果键名不是合法的标识符，且也不是数字，定义时必须加上引号，否则会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="string">&#x27;1p&#x27;</span>: <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>索引类型也可以写成 <code>Record</code>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="variable constant_">A1</span> = &#123;</span><br><span class="line">  [<span class="attr">k</span>: <span class="built_in">string</span>]: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">A2</span> = <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt;</span><br></pre></td></tr></table></figure>

<p>注：<code>Object</code> 类型范围太广，原始类型因为包装对象，也能用 <code>Object</code> 类型描述，所以 <code>Object</code> 类型基本等同于 <code>any</code> 类型，一般不用，无意义。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="title class_">Object</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">b</span>: <span class="built_in">object</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>数组</li>
</ul>
<p>使用 <code>type[]</code>、<code>Array&lt;type&gt;</code> 泛型接口和元组描述数组。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = <span class="built_in">string</span>[]</span><br><span class="line"><span class="keyword">type</span> A = <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line"><span class="keyword">type</span> A = [<span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">string</span>] <span class="comment">// 三元组，还可以数组包含数组 type A = [string[], number[]]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment">// TypeScript 类型是值得集合</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: A = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多维数组</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">arr</span>: <span class="built_in">number</span>[][] = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]] <span class="comment">// 或者 Array&lt;Array&lt;number&gt;&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只读数组</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">arr</span>:<span class="keyword">readonly</span> <span class="built_in">number</span>[] = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">arr[<span class="number">1</span>] = <span class="number">2</span> <span class="comment">// 报错</span></span><br><span class="line">arr.<span class="title function_">push</span>(<span class="number">3</span>) <span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">delete</span> arr[<span class="number">0</span>] <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可选元组</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: [<span class="built_in">number</span>, <span class="built_in">number</span>?] = [<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>函数对象</li>
</ul>
<p>使用形同于 JS 的箭头函数语法 <code>(param: type) =&gt; type</code> 来描述函数的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">FnA</span> = <span class="function">(<span class="params">param: <span class="keyword">type</span></span>) =&gt;</span> <span class="keyword">type</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">FnA</span> = <span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="title class_">FnA</span> = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可将类型写进函数中</span></span><br><span class="line"><span class="keyword">const</span> a = (<span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>void</code> 指没有返回值，<code>undefined</code> 指返回 <code>undefined</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">FnA</span> = <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="title class_">FnA</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello World&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">FnA</span> = <span class="function">() =&gt;</span> <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="title class_">FnA</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：<code>Function</code> 类型不精确，描述函数无意义。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="title class_">Function</span> = <span class="function">() =&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>其他对象</li>
</ul>
<p>使用 <code>class</code>（构造函数） 描述其他对象。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">d</span>: <span class="title class_">Date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="attr">r</span>: <span class="title class_">RegExp</span> = <span class="regexp">/ab+c/</span> <span class="comment">// new RegExp(&#x27;ab+c&#x27;)</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">m</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;xxx&#x27;</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="attr">wm</span>: <span class="title class_">WeakMap</span>&lt;&#123;<span class="attr">name</span>: <span class="built_in">string</span>&#125;, <span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="attr">s</span>: <span class="title class_">Set</span>&lt;<span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">s.<span class="title function_">add</span>(<span class="number">123</span>)</span><br><span class="line">cosnt <span class="attr">ws</span>: <span class="title class_">WeakSet</span>&lt;<span class="built_in">string</span>[]&gt; = <span class="keyword">new</span> <span class="title class_">WeakSet</span>()</span><br></pre></td></tr></table></figure>

<p>注意：由于类型推断的存在，有些类型描述可以省略，但是有些不能，一但省略，类型会被推断扩大，导致精度缺失。上述例子中的 <code>Date</code>、<code>RegExp</code> 类型都可以从右边推断出来，可以省略，但是 <code>Map</code> 就不能， 如果省略，会被推断为 <code>any</code>，因为有泛型。</p>
<h3 id="内联类型注解"><a href="#内联类型注解" class="headerlink" title="内联类型注解"></a>内联类型注解</h3><p>如果一个类型不需要复用，可不使用接口或类型别名，而是通过内联类型注解，这样省去为类型起名的麻烦。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内联基本类型注解</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myString</span>: <span class="string">&#x27;Hello&#x27;</span> = <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myNumber</span>: <span class="number">42</span> = <span class="number">42</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myBoolean</span>: <span class="literal">true</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 内联对象类型注解</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">person</span>: &#123; <span class="attr">name</span>: <span class="built_in">string</span>; <span class="attr">age</span>: <span class="built_in">number</span>; &#125; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内联函数类型注解</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">foo</span>: <span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = <span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="built_in">any</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">// as 断言</span></span><br><span class="line"><span class="keyword">const</span> b = a <span class="keyword">as</span> <span class="built_in">number</span></span><br><span class="line"><span class="comment">// 尖括号断言</span></span><br><span class="line"><span class="keyword">const</span> c = &lt;<span class="built_in">number</span>&gt;a</span><br></pre></td></tr></table></figure>

<p>使用 <code>const</code> 声明的常量，只有原始类型才能被推导为字面量类型，对于数组或对象，由于其元素可变，类型会往范围大推导，要想推导为字面量类型，只能使用 <code>as const</code> 断言。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="string">&#x27;b&#x27;</span> <span class="comment">// const 常量，不能被修改，类型往范围小推导为 &#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="string">&#x27;hi&#x27;</span>] <span class="comment">// 类型被推导为 (string | number)[]，而不是 readonly [1, &quot;hi&quot;]</span></span><br></pre></td></tr></table></figure>

<p><code>as const</code> 类型断言，用于告诉编译器将某个表达式断言为一个不可变的字面量类型。可以应用于字符串字面量、数字字面量、对象字面量、数组字面量等，将它们转换为对应的不可变的字面量类型（断言为常量类型）。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;b&#x27;</span> <span class="keyword">as</span> <span class="keyword">const</span> <span class="comment">//类型往范围小推导为 &#x27;b&#x27;，如果不加 as const，类型会往大范围推导为 string</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="string">&#x27;hi&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span> <span class="comment">// 类型被推导为 readonly [1, &quot;hi&quot;]，如果不加 as const，类型会被推到为 (string | number)[]，尽管 const 声明的数组不能被重新赋值，但是能 push</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125; <span class="keyword">as</span> <span class="keyword">const</span> <span class="comment">// 类型被推导为 &#123; readonly a: 1; readonly b: 2 &#125;，而不是 &#123; a: number; b: number &#125;，道理跟上面数组一样</span></span><br></pre></td></tr></table></figure>

<p>常见的应用场景：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>] <span class="keyword">as</span> <span class="keyword">const</span> <span class="comment">// 如果不 as const，类型会往大范围推导，导致不符合函数参数类型而报错</span></span><br><span class="line"><span class="title function_">add</span>(...arr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同理</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;JavaScript&#x27;</span> <span class="keyword">as</span> <span class="keyword">const</span> <span class="comment">// 如果不 as const 或 const s = &#x27;javascript&#x27; 会报错</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Lang</span> =</span><br><span class="line">  |<span class="string">&#x27;JavaScript&#x27;</span></span><br><span class="line">  |<span class="string">&#x27;TypeScript&#x27;</span></span><br><span class="line">  |<span class="string">&#x27;Python&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setLang</span>(<span class="params">language: Lang</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setLang</span>(s)</span><br></pre></td></tr></table></figure>

<h2 id="类型兼容"><a href="#类型兼容" class="headerlink" title="类型兼容"></a>类型兼容</h2><p>JavaScript 是一门非常灵活的语言，比如，函数可以少传参数（默认参数），对象类型的参数可以多传字段等等，为了适应这些灵活的特性，TypeScript 支持类型兼容，防止类型不匹配导致类型报错。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// runTask 只接受 a、b、c</span></span><br><span class="line"><span class="comment">// 如果严格类型检查，多传了 d 会导致类型不匹配报错，必须将 d pick 掉</span></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">d</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> newConfig = lodash.<span class="title function_">pick</span>(config, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="title function_">runTask</span>(newConfig)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实际需求中，需要兼容多传的 d，不处理即可</span></span><br><span class="line"><span class="title function_">runTask</span>(config)</span><br></pre></td></tr></table></figure>

<p>如果类型 <code>S</code> 的值可以赋值给类型 <code>T</code>，那么类型 <code>S</code> 就称为类型 <code>T</code> 的子类型，即 <code>S &lt;: T</code> (或 <code>T :&gt; S</code>)，范围大的兼容范围小的，<code>T</code> 兼容 <code>S</code>，反之则不能。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T = <span class="built_in">boolean</span></span><br><span class="line"><span class="keyword">type</span> S = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// S 是 T 的子类型，S 类型的值可以赋值给 T 类型的变量</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: S = <span class="literal">true</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: T = b</span><br><span class="line"></span><br><span class="line"><span class="comment">// 反过来父类型的值则不能赋值给子类型的变量</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: T = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: S = b</span><br></pre></td></tr></table></figure>

<ul>
<li>简单类型的兼容</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = <span class="built_in">number</span> | <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: A = b <span class="comment">// a 的类型兼容 b 的类型，b 的类型 number 就是 a 的类型 number|string 的子类型</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">string</span> = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="string">&#x27;hi&#x27;</span> = <span class="string">&#x27;hi&#x27;</span></span><br><span class="line"></span><br><span class="line">a = b <span class="comment">// 正确</span></span><br><span class="line">b = a <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<ul>
<li>普通对象类型的兼容</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// user 没有显式声明类型，其类型会被推断出来，可通过 type User = typeof user 查看</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aa&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">  <span class="attr">email</span>: <span class="string">&#x27;xxx@gmail.com&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// user 类型的限制条件多，范围更小，user 的类型是 Person 的子类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">p</span>: <span class="title class_">Person</span> = user</span><br></pre></td></tr></table></figure>

<ul>
<li>接口类型的兼容</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> 父接口 &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> 子接口 <span class="keyword">extends</span> 父接口 &#123;</span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">objectChild</span>: 子接口 = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">  <span class="attr">y</span>: <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">objectParent</span>: 父接口</span><br><span class="line">objectParent = objectChild</span><br></pre></td></tr></table></figure>

<p>字段有重叠部分，也可构成父子关系，不一定非要通过 <code>extends</code> 继承。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> 有左手的人 &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> 有双手的人 &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">right</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">person</span>: 有双手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">  <span class="attr">right</span>: <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">personLeft</span>: 有左手的人 = person</span><br></pre></td></tr></table></figure>

<p>注意：为某个类型赋予违反其结构的值时，则会提示类型错误，这与类型兼容，子类型可以赋值给父类型不矛盾。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 有左手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错：Object literal may only specify known properties, and &#x27;right&#x27; does not exist in type &#x27;有左手的人&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">person1</span>: 有左手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">  <span class="attr">right</span>: <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当然可通过断言或索引签名解决这个问题</span></span><br><span class="line"><span class="keyword">type</span> 有左手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">person1</span>: 有左手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">  <span class="attr">right</span>: <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">&#125; <span class="keyword">as</span> 有左手的人;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> 有左手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="built_in">string</span>;</span><br><span class="line">  [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">string</span>; <span class="comment">// 允许有其他字符串类型的属性</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">person1</span>: 有左手的人 = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">  <span class="attr">right</span>: <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>函数的类型兼容</li>
</ul>
<p>在判断两个函数的兼容性时，需要考虑参数数量、参数类型、返回值类型。</p>
<p>参数数量的兼容，遵守协变规则，数量多的兼容数量少的：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> 接受一个参数的函数 = <span class="function">(<span class="params">a: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> 接受两个参数的函数 = <span class="function">(<span class="params">b: <span class="built_in">number</span>, c: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(b, c)</span><br><span class="line">&#125;</span><br><span class="line">接受两个参数的函数 = 接受一个参数的函数</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JS 中少传参数很常见</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, fn)</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, fn, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">items.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(item))</span><br><span class="line">items.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index, array</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(item))</span><br></pre></td></tr></table></figure>

<p>参数类型的兼容，逆变，即取反：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://mp.weixin.qq.com/s?__biz=MzIwNzUxODI4Nw==&amp;mid=2247483668&amp;idx=1&amp;sn=a4ea1e53acad7309741d42e159c188e8&amp;chksm=97106e34a067e722fac7cdff6310833cbd5cff89a83d8c4654ae785a05846577c658605f41c7&amp;=1564638183&amp;=zh_CN#rd</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyEvent</span> &#123;</span><br><span class="line">  <span class="attr">target</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyMouseEvent</span> <span class="keyword">extends</span> <span class="title class_">MyEvent</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">listener</span> = (<span class="params">e: MyEvent</span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">mouseListener</span> = (<span class="params">e: MyMouseEvent</span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">x</span>, e.<span class="property">y</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数类型 MyEvent 是 MyMouseEvent 的父类型，函数的类型取反即可，mouseListener 是 listener 的父类型</span></span><br><span class="line">mouseListener = listener</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实际工作中的函数</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyEvent</span> &#123;</span><br><span class="line">  <span class="attr">target</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyMouseEvent</span> <span class="keyword">extends</span> <span class="title class_">MyEvent</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">listener</span> = (<span class="params"><span class="keyword">type</span>: <span class="built_in">string</span>, fn: (e: MyEvent) =&gt; <span class="built_in">void</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以 click 方式使用 listener</span></span><br><span class="line"><span class="title function_">listener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 函数在声明时，已定义 e 的类型为 MyEvent，要使用 MyMouseEvent 的属性，需断言</span></span><br><span class="line">  <span class="comment">// 或者 tsconfig 中将 strictFunctionTypes 设为 false（默认下 strict: true 启用所有严格的类型检查选项），不推荐</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>((e <span class="keyword">as</span> <span class="title class_">MyMouseEvent</span>).<span class="property">x</span>, (e <span class="keyword">as</span> <span class="title class_">MyMouseEvent</span>).<span class="property">y</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者对整个 callback 函数断言</span></span><br><span class="line"><span class="title function_">listener</span>(<span class="string">&#x27;click&#x27;</span>, (<span class="function">(<span class="params">e: MyMouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">x</span>, e.<span class="property">y</span>)</span><br><span class="line">  &#125;) <span class="keyword">as</span> (<span class="attr">e</span>: <span class="title class_">MyEvent</span>) =&gt; <span class="built_in">void</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>返回值类型的兼容，协变：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> 返回值属性少集合大 = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;tracy&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> 返回值属性多集合小 = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;tracy&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">返回值属性少集合大 = 返回值属性多集合小</span><br></pre></td></tr></table></figure>

<ul>
<li>特殊类型的兼容</li>
</ul>
<p>特殊类型赋值表：</p>
<table>
<thead>
<tr>
<th>类型&#x2F;类型</th>
<th><code>any</code></th>
<th><code>unknown</code></th>
<th><code>object</code></th>
<th><code>void</code></th>
<th><code>undefined</code></th>
<th><code>null</code></th>
<th><code>never</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>any</code> -&gt;</td>
<td>-</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>×</td>
</tr>
<tr>
<td><code>unknown</code> -&gt;</td>
<td>√</td>
<td>-</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td><code>object</code> -&gt;</td>
<td>√</td>
<td>√</td>
<td>-</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td><code>void</code> -&gt;</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>-</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td><code>undefined</code> -&gt;</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>-</td>
<td>√</td>
<td>×</td>
</tr>
<tr>
<td><code>null</code> -&gt;</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>-</td>
<td>×</td>
</tr>
<tr>
<td><code>never</code> -&gt;</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>-</td>
</tr>
</tbody></table>
<p>范围小的允许赋值给范围大的，反之不能。<code>any</code> 何 <code>unknown</code> 范围是最大，即 Top Type，其它所有类型都可以赋值给这两个类型的变量，<code>never</code> 是范围最小的，即 Bottom Type，其它所有类型都不能赋值给它。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// any</span></span><br><span class="line"><span class="comment">// any 类型的值除不能赋值给 never 类型的变量外，其它都可</span></span><br><span class="line"><span class="comment">// 所有类型都可以赋值给 any</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">any</span> <span class="comment">// let a: never 则不能</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="built_in">any</span> = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">a = b</span><br><span class="line"></span><br><span class="line"><span class="comment">// unknown </span></span><br><span class="line"><span class="comment">// unknown 不能赋值给除 any 外的其它所有类型变量，因为没有收窄</span></span><br><span class="line"><span class="comment">// 所有类型都可以赋值给 unknown</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// object</span></span><br><span class="line"><span class="comment">// 小写 object 也是一个比较大的类型（不包含基本类型），除了 any、unknown 外，不能赋值给其它比它小的类型</span></span><br><span class="line"><span class="comment">// 其它类型，除 unknown 和 void 外，都可以赋值给 object（undefined、null 与 object 不存在父子关系，默认 strictNullChecks: true 配置下，不能赋值给 object，但为了适应 JS 的使用习惯，声明变量但不赋值，或者将一个 object 赋值为 null，可以将此选项设为 fase，支持赋值）</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">object</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">object</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void</span></span><br><span class="line"><span class="comment">// void 只能赋值给 any 和 unknown。void 可以看成时 undefined 和 null 的集合，不能赋值给 undefined 或 null，因为比它们大，也不能赋值给 object，因为不构成父子关系</span></span><br><span class="line"><span class="comment">// any、undefined、null、never 可以赋值给 void（对于 null，需要将 strictNullChecks 设为 false）</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">void</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// null、undefined</span></span><br><span class="line"><span class="comment">// null、undefined 可以赋值给除 never 外的所有类型，strictNullChecks 为 true 严格检查下，这两种类型不能相互赋值，除非设为 false</span></span><br><span class="line"><span class="comment">// any、never 可以赋值给 null、undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="literal">null</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="literal">undefined</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// never</span></span><br><span class="line"><span class="comment">// never 可以看成是最小的集合，能赋值给其它所有类型</span></span><br><span class="line"><span class="comment">// 其它所有类型都不能赋值给 never</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/378388758">https://zhuanlan.zhihu.com/p/378388758</a></p>
<p><a target="_blank" rel="noopener" href="https://www.kancloud.cn/pwstrick/fe-questions/1457752">https://www.kancloud.cn/pwstrick/fe-questions/1457752</a></p>
<h2 id="深入函数"><a href="#深入函数" class="headerlink" title="深入函数"></a>深入函数</h2><h3 id="函数的类型"><a href="#函数的类型" class="headerlink" title="函数的类型"></a>函数的类型</h3><p>函数的类型（不是函数类型）包括函数参数和返回值的类型。</p>
<ul>
<li>函数声明的类型</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>函数表达式的类型</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = (<span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面实际只对等号右侧的匿名函数表达式进行了类型定义，而等号左边的 foo，是通过赋值操作使用类型推断出来的</span></span><br><span class="line"><span class="keyword">type</span> F = <span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">foo</span>: F = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b</span><br></pre></td></tr></table></figure>

<p>还可使用对象类型或 <code>interface</code> 定义函数表达式的类型，这种写法适合带有属性的函数的类型声明。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 或者 interface F &#123;</span></span><br><span class="line"><span class="keyword">type</span> F = &#123;</span><br><span class="line">  (<span class="attr">a</span>: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span>): <span class="built_in">number</span></span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">foo</span>: F = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line">foo.<span class="property">count</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>注意：类型谓词函数使用函数表达式定义时，函数的类型不能注解在等号左边，否则会报错，因为右边的值不符合左边的类型结构，右边返回的是 <code>boolean</code>，左边声明的是 <code>x is xxx</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型谓词函数注解不能使用箭头函数类型，只能在函数体中注解</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Animal</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a: Person | Animal</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isPerson</span>(a)) &#123;</span><br><span class="line">    a.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// x is Person 不能使用 boolean 代替，因为返回的不单单是一个布尔，还要与 Person 关联起来，是不是一个 Person</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isPerson</span>(<span class="params">x: Person | Animal</span>): x is <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="comment">// 可以简写为 return &#x27;name&#x27; in x</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型谓词函数的类型不能注解在等号左边，否则会报错，因为右边的值不符合左边的类型结构，右边返回的是 boolean，左边声明的是 x is Person</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">isPerson</span>: <span class="function">(<span class="params">x: Person | Animal</span>) =&gt;</span> x is <span class="title class_">Person</span>  = <span class="function">(<span class="params">x</span>) =&gt;</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> x</span><br><span class="line"><span class="comment">// 这也是错的</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">isPerson</span>: &#123;</span><br><span class="line">  (<span class="attr">x</span>: <span class="title class_">Person</span> | <span class="title class_">Animal</span>): x is <span class="title class_">Person</span></span><br><span class="line">&#125; = <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> x</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h3><ul>
<li>可选参数</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addEventListener</span>(<span class="params">eventType: <span class="built_in">string</span>, fn: <span class="built_in">unknown</span>, useCapture?: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(eventType, fn, useCapture)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>默认参数</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addEventListener</span>(<span class="params">eventType: <span class="built_in">string</span>, fn: (<span class="variable language_">this</span>: HTMLElement, e: Event) =&gt; <span class="built_in">void</span>, useCapture = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 模拟浏览器实现</span></span><br><span class="line">  <span class="keyword">const</span> element = &#123;&#125; <span class="keyword">as</span> <span class="title class_">HTMLElement</span></span><br><span class="line">  <span class="keyword">const</span> event = &#123;&#125; <span class="keyword">as</span> <span class="title class_">Event</span></span><br><span class="line">  fn.<span class="title function_">call</span>(element, event)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(eventType, fn, useCapture)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>剩余参数</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arr 是一个数组，应使用数组的类型定义</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...arr: <span class="built_in">number</span>[]</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, item</span>) =&gt;</span> acc + item, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>注：形参为 Rest 参数的函数在调用时，如果实参是 <code>array</code>，需要将参数展开。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numList = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="comment">// 使用 spread 展开</span></span><br><span class="line"><span class="title function_">sum</span>(...numList)</span><br><span class="line"><span class="comment">// 使用 apply 展开</span></span><br><span class="line">sum.<span class="title function_">apply</span>(<span class="literal">null</span>, numList)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>this</code> 类型</li>
</ul>
<p>从 TypeScript 对 <code>this</code> 类型的实现看，<code>this</code> 本质是一个参数，只是它的传参比较特殊，一般通过对象调用或者 <code>call</code>、<code>apply</code>、<code>bind</code> 传。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"><span class="variable language_">this</span>: Person, word: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>, word)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// type FnWithThis = (this: Person, word: string) =&gt; void</span></span><br><span class="line"><span class="comment">// const sayHi: FnWithThis = function (word) &#123;</span></span><br><span class="line"><span class="comment">//   console.log(this.name, word)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用对象调用传 p.sayHi</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">p1</span>: <span class="title class_">Person</span> &amp; &#123;<span class="attr">sayHi</span>: <span class="keyword">typeof</span> sayHi&#125; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;tracy&#x27;</span>,</span><br><span class="line">  <span class="attr">sayHi</span>: sayHi</span><br><span class="line">&#125;</span><br><span class="line">p1.<span class="title function_">sayHi</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 call、apply、bind 传</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">p2</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;tracy&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">sayHi.<span class="title function_">call</span>(p2, <span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">sayHi.<span class="title function_">apply</span>(p2, [<span class="string">&#x27;hello&#x27;</span>])</span><br><span class="line">sayHi.<span class="title function_">bind</span>(p2)(<span class="string">&#x27;hello&#x27;</span>) <span class="comment">// sayHi.bind(p2, &#x27;hello&#x27;)()</span></span><br></pre></td></tr></table></figure>

<ul>
<li>解构参数</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Config</span> = &#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span> | <span class="string">&#x27;POST&#x27;</span> | <span class="string">&#x27;PATCH&#x27;</span> | <span class="string">&#x27;DELETE&#x27;</span></span><br><span class="line">  data?: <span class="built_in">unknown</span></span><br><span class="line">  headers?: <span class="built_in">unknown</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型也可以写在等号的右边</span></span><br><span class="line"><span class="comment">// function ajax(&#123; url, method, ...rest &#125; = &#123; method: &#x27;GET&#x27;, url: &#x27;&#x27; &#125; as Config) &#123;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">&#123; url, method, ...rest &#125;: Config = &#123; method: <span class="string">&#x27;GET&#x27;</span>, url: <span class="string">&#x27;&#x27;</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数重载（overload）"><a href="#函数重载（overload）" class="headerlink" title="函数重载（overload）"></a>函数重载（overload）</h3><p>重载本质是同名的函数，目的是为了接收不同类型或数量的参数，是实现多态的一种方式。重载来自于面向对象，像 Java 这些传统的面向对象语言不支持联合类型，要想支持不同类型或数量的参数只能通过重载实现。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数数量不同</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createDate</span>(<span class="params">n: <span class="built_in">number</span></span>): <span class="title class_">Date</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createDate</span>(<span class="params">year: <span class="built_in">number</span>, month: <span class="built_in">number</span>, date: <span class="built_in">number</span></span>): <span class="title class_">Date</span>;</span><br><span class="line"><span class="comment">// 函数体</span></span><br><span class="line"><span class="comment">// 要兼容上面所有的定义</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createDate</span>(<span class="params">a: <span class="built_in">number</span>, b?: <span class="built_in">number</span>, c?: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (a !== <span class="literal">undefined</span> &amp;&amp; b !== <span class="literal">undefined</span> &amp;&amp; c !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(a, b, c)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a !== <span class="literal">undefined</span> &amp;&amp; b === <span class="literal">undefined</span> &amp;&amp; c === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(a)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;只接收一个或三个参数&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用联合类型实现。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数类型不同</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createDate</span>(<span class="params">n: <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 收窄</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数数量不同</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createDate</span>(<span class="params">...args: [<span class="built_in">number</span>] | [<span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]</span>): <span class="title class_">Date</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (args.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(args[<span class="number">0</span>]);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (args.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(args[<span class="number">0</span>], args[<span class="number">1</span>], args[<span class="number">2</span>]);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;只接收一个或三个参数&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基于-class-的面向对象"><a href="#基于-class-的面向对象" class="headerlink" title="基于 class 的面向对象"></a>基于 class 的面向对象</h2><p>面向对象的两个流派，基于原型和基于类 <code>class</code>。</p>
<h3 id="interface-和-class-的区别"><a href="#interface-和-class-的区别" class="headerlink" title="interface 和 class 的区别"></a>interface 和 class 的区别</h3><p><code>interface</code> 是类型，只有成员的类型没有实现，<code>class</code> 是值，既有成员类型也有成员实现。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="comment">// 默认实现为 undefined，不符合前面 number 的类型定义，需要修改编译配置，才不会报错</span></span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>成员属性如果不初始化，需要将严格检查设为 <code>&quot;strict&quot;: false</code>，或者设置单独的 <code>&quot;strictPropertyInitialization&quot;: false</code>，否则会报属性没有初始化，也没有在 <code>constructor</code> 中赋值错误。JS 中变量或属性不赋值，会自动赋值为 <code>undefined</code>，不符合前面 <code>number</code> 的类型定义。</p>
<h3 id="class-构造函数"><a href="#class-构造函数" class="headerlink" title="class 构造函数"></a>class 构造函数</h3><ul>
<li>属性的声明和初始化</li>
</ul>
<p>类顶部声明，构造函数中初始化：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认值</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">x = <span class="number">0</span>, y = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = x</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类顶部声明和初始化：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span> = <span class="number">0</span> <span class="comment">// 类型也可省略通过赋值推断出。new 的时候赋值，x 是对象的成员属性</span></span><br><span class="line">  <span class="attr">y</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类顶部声明，成员方法中初始化：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型检查会报错，需使用 ! 感叹号，放弃检查</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  x!: <span class="built_in">number</span></span><br><span class="line">  y!: <span class="built_in">number</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initData</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">initData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>声明、初始化、默认值的构造函数简写：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 推荐写法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> x: <span class="built_in">number</span> = <span class="number">0</span>, <span class="keyword">public</span> y: <span class="built_in">number</span> = <span class="number">0</span></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>构造函数重载</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  x!: <span class="built_in">number</span></span><br><span class="line">  y!: <span class="built_in">number</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>)</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">s: <span class="built_in">string</span></span>)</span><br><span class="line">  <span class="comment">// x 和 s 合并变为 xs: number | string，y 合并变为可选 y?: number</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">xs: <span class="built_in">number</span> | <span class="built_in">string</span>, y?: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> xs === <span class="string">&#x27;number&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> y === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">x</span> = xs</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">y</span> = y</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> xs === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> parts = xs.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">x</span> = <span class="built_in">parseFloat</span>(parts[<span class="number">0</span>])</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">y</span> = <span class="built_in">parseFloat</span>(parts[<span class="number">1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="string">&#x27;1,2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>索引签名</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hash</span> &#123;</span><br><span class="line">  <span class="comment">// Hash 的下标为 string，值为任意类型</span></span><br><span class="line">  [<span class="attr">s</span>: <span class="built_in">string</span>]: <span class="built_in">unknown</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key: <span class="built_in">string</span>, value: <span class="built_in">unknown</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>[key] = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>[key]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="class-实现-interface"><a href="#class-实现-interface" class="headerlink" title="class 实现 interface"></a>class 实现 interface</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">sayHi</span>: <span class="function">(<span class="params">target: Person</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params">target: Person</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hi <span class="subst">$&#123;target.name&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现两个接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">sayHi</span>: <span class="function">(<span class="params">target: Person</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Taggable</span> &#123;</span><br><span class="line">  <span class="attr">tags</span>: <span class="built_in">string</span>[]</span><br><span class="line">  <span class="attr">addTag</span>: <span class="function">(<span class="params">tag: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="attr">removeTag</span>: <span class="function">(<span class="params">tag: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Person</span>, <span class="title class_">Taggable</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, <span class="keyword">public</span> tags: <span class="built_in">string</span>[] = []</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params">target: Person</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hi <span class="subst">$&#123;target.name&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">addTag</span>(<span class="params">tag: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tags</span>.<span class="title function_">push</span>(tag)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">removeTag</span>(<span class="params">tag: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="variable language_">this</span>.<span class="property">tags</span>.<span class="title function_">indexOf</span>(tag)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tags</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有实现的可选属性，不能访问</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  age?: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">sayHi</span>: <span class="function">(<span class="params">target: Person</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params">target: Person</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hi <span class="subst">$&#123;target.name&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;tracy&#x27;</span>)</span><br><span class="line">u.<span class="property">age</span> <span class="comment">// 类型报错，age 没有被实现</span></span><br></pre></td></tr></table></figure>

<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`你好，我是<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> id: <span class="built_in">number</span>, name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name) <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">login</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="comment">// override 重写 sayHi</span></span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params">target?: User</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (target === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>.<span class="title function_">sayHi</span>() <span class="comment">// 调用父类的 sayHi</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`你好<span class="subst">$&#123;target.name&#125;</span>，我是<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&#x27;tracy&#x27;</span>)</span><br><span class="line">u.<span class="title function_">sayHi</span>()</span><br><span class="line">u.<span class="title function_">login</span>()</span><br></pre></td></tr></table></figure>

<p>继承时重写属性类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  friend?: <span class="title class_">Person</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, friend?: Person</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">friend</span> = friend</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="keyword">declare</span> <span class="attr">friend</span>: <span class="title class_">User</span> <span class="comment">// 重写属性类型</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> id: <span class="built_in">number</span>, name: <span class="built_in">string</span>, friend?: User</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name, friend)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u1 = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&#x27;tracy&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> u2 = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2</span>, <span class="string">&#x27;kobe&#x27;</span>, u1)</span><br><span class="line">u2.<span class="property">friend</span> <span class="comment">// u2 的 friend 应该为 User，如果不 declare friend: User，类型会是 Person | undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="成员访问修饰符"><a href="#成员访问修饰符" class="headerlink" title="成员访问修饰符"></a>成员访问修饰符</h3><ul>
<li>public、private、protected、#</li>
</ul>
<p><code>public</code> 类外可见，是默认修饰符，<code>private</code> 类内可见，<code>protected</code> 子类可见。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> friend?: <span class="title class_">Person</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, friend?: Person</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">friend</span> = friend</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;tracy&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;kobe&#x27;</span>, p1)</span><br><span class="line">p2.<span class="property">friend</span>  <span class="comment">// 报错，外部不可见</span></span><br></pre></td></tr></table></figure>

<p><code>private</code> 是编译时私有修饰符，会被擦除，而 <code>#</code> 是 ES 标准库私有修饰符，编译时和运行时都会检查。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  #friend?: <span class="title class_">Person</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span>, friend?: Person</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.#friend = friend</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;tracy&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;kobe&#x27;</span>, p1)</span><br><span class="line">p2.<span class="property">friend</span>  <span class="comment">// 报错，外部不可见</span></span><br></pre></td></tr></table></figure>

<ul>
<li>static 和 static block</li>
</ul>
<p><code>static</code> 静态属性修饰符。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="attr">xxx</span>: <span class="number">222</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不是所有的属性都能做静态属性，比如 <code>name</code>，因为 JavaScript 中类都是通过函数实现的，会与 <code>Function.name</code> 冲突，其它的属性 <code>prototype</code>、<code>arguments</code>、<code>caller</code>、<code>length</code> 同理。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>static block 用来初始化静态属性，其在类创建时执行，只执行一次，而不是对象创建时，这比在类外面初始化，或 <code>constructor</code> 中初始化理想，前者脱离了类，后者又会被多次执行。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统计类初始化次数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> #count = <span class="number">0</span></span><br><span class="line">  <span class="comment">// static block 在类创建时执行，而不是对象创建时，可以来初始化静态私有属性</span></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="built_in">parseInt</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;count&#x27;</span>)) || <span class="number">0</span></span><br><span class="line">    <span class="title class_">Foo</span>.#count = count + <span class="number">1</span></span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;count&#x27;</span>, <span class="title class_">Foo</span>.#count)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.#count)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hash</span>&lt;K, V&gt; &#123;</span><br><span class="line">  <span class="attr">map</span>: <span class="title class_">Map</span>&lt;K, V&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key: K, value: V</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">map</span>.<span class="title function_">set</span>(key, value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key: K</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">map</span>.<span class="title function_">get</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> h = <span class="keyword">new</span> <span class="title class_">Hash</span>&lt;<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="title class_">Date</span> | <span class="title class_">Array</span>&lt;<span class="built_in">any</span>&gt;, <span class="built_in">string</span> | <span class="built_in">number</span>&gt;()</span><br><span class="line">h.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">h.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hash</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">Map</span>&lt;K, V&gt; &#123;</span><br><span class="line">  <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><p>抽象类是基类，其不能直接使用，需要 <code>extends</code> 实现，比起 <code>interface</code> 只有类型，<code>class</code> 又有类型又有实现，而 <code>abstract</code> 可以选择性实现，如果什么都不实现，其实就是一个 <code>interface</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">sayHi</span>(): <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(<span class="number">18</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实例的类型"><a href="#实例的类型" class="headerlink" title="实例的类型"></a>实例的类型</h3><p>实例的类型既可以是使用 interface，也可以使用类。类本身就是一种类型，但是它代表该类的实例类型，而不是 class 的自身类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">p</span>: <span class="title class_">Person</span> = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;tracy&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 interface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="title function_">sayHi</span>(): <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类的类型"><a href="#类的类型" class="headerlink" title="类的类型"></a>类的类型</h3><p>类自身的类型可使用 <code>typeof 构造函数</code>或 <code>new () =&gt; xxx</code> 构造函数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里需要使用构造函数的类型，而不是实例的类型（Person 类型是 new Person() 实例的类型）。有两种实现方法</span></span><br><span class="line"><span class="comment">// 方法 1：typeof Person 表示 Person 类的构造函数类型。在 JS 中，类本身是一个函数，即类的构造函数。因此，typeof Person（操作数 Person 是值）返回的是 Person 类的构造函数类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">personClass: <span class="keyword">typeof</span> Person</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title function_">personClass</span>(<span class="string">&#x27;tracy&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> p.<span class="property">name</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法 2：new (name: string) =&gt; Person 表示它是一个接受一个字符串参数并返回 Person 类型实例的构造函数类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">personClass: <span class="keyword">new</span> (name: <span class="built_in">string</span>) =&gt; Person</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title function_">personClass</span>(<span class="string">&#x27;tracy&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> p.<span class="property">name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="title class_">Person</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法 2 的构造函数还可以写位对象形式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span></span><br><span class="line"><span class="params">  personClass: &#123;</span></span><br><span class="line"><span class="params">    <span class="keyword">new</span> (name: <span class="built_in">string</span>): Person</span></span><br><span class="line"><span class="params">  &#125;</span></span><br><span class="line"><span class="params"></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title function_">personClass</span>(<span class="string">&#x27;tracy&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> p.<span class="property">name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果类型需要复用，还可以使用 interface 或 type 命名 </span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PersonConstructor</span> &#123;</span><br><span class="line">  <span class="title function_">new</span>(<span class="attr">name</span>: <span class="built_in">string</span>): <span class="title class_">Person</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">personClass: PersonConstructor</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title function_">personClass</span>(<span class="string">&#x27;tracy&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> p.<span class="property">name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类型运算符"><a href="#类型运算符" class="headerlink" title="类型运算符"></a>类型运算符</h2><p>TypeScript 提供强大的类型运算能力，可以使用各种类型运算符，对已有的类型进行计算，得到新类型。</p>
<h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><p>在 JavaScript 中，<code>typeof</code> 运算符返回一个字符串，代表操作数的类型。TypeScript 也有 <code>typeof</code> 运算符，它的操作数依然是一个值，返回的是该值的 TypeScript 类型，而不是字符串。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123; <span class="attr">x</span>: <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">A0</span> = <span class="keyword">typeof</span> a   <span class="comment">// &#123; x: number &#125;</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">A1</span> = <span class="keyword">typeof</span> a.<span class="property">x</span> <span class="comment">// number</span></span><br></pre></td></tr></table></figure>

<p>TypeScript 中的 <code>typeof</code> 是类型运算，而 JavaScript 中的 <code>typeof</code> 是值运算。由于编译时不会进行 JavaScript 值运算，TypeScript 中的 <code>typeof</code> 操作数只能是值的标识符（变量、函数、类），不能是值的表达式。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="comment">// 类型运算</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="keyword">typeof</span> a</span><br><span class="line"></span><br><span class="line"><span class="comment">// 值运算</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> a === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">  b = a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 操作数不能是值的表达式</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="keyword">typeof</span> <span class="title class_">Date</span>() <span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="keyword">typeof</span> <span class="string">&#x27;111&#x27;</span> <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作数不能是类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">A1</span> = <span class="keyword">typeof</span> <span class="variable constant_">A0</span> <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<h3 id="keyof"><a href="#keyof" class="headerlink" title="keyof"></a>keyof</h3><h2 id="泛型编程"><a href="#泛型编程" class="headerlink" title="泛型编程"></a>泛型编程</h2><p>泛型（Generics）是指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定类型的一种特性，主要作用是对不特定数据类型的支持，以实现函数、接口（Interface）、类的复用。</p>
<p>泛型类似于函数，函数的本质是推后执行（调用），部分待定（参数）的代码，泛型的本质是推后执行（调用），部分待定（泛型参数）的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> F&lt;A, B&gt; = A | B</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = F&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; <span class="comment">// 调用</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">List</span>&lt;A&gt; &#123;</span><br><span class="line">  [<span class="attr">index</span>: <span class="built_in">number</span>]: A</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> X = <span class="title class_">List</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用代入法查看泛型调用后的具体类型</span></span><br><span class="line"><span class="keyword">type</span> X = &#123;</span><br><span class="line">  [<span class="attr">index</span>: <span class="built_in">number</span>]: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Hash</span>&lt;V = <span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  [<span class="attr">key</span>: <span class="built_in">string</span>]: V</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>泛型中使用 <code>extends</code> 和三元运算符</li>
</ul>
<p>泛型中使用 <code>extends</code>，判断是否为子类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LikeString</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">string</span> ? <span class="literal">true</span> : <span class="literal">false</span> <span class="comment">// 如果 T 继承/包含于 string（T 是 string 的子类型），那就返回 true </span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LikeNumber</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">number</span> ? <span class="number">1</span> : <span class="number">2</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LikePerson</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="title class_">Person</span> ? <span class="string">&#x27;yes&#x27;</span> : <span class="string">&#x27;no&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">LikeString</span>&lt;<span class="string">&#x27;a&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>若 <code>T</code> 为联合类型，则会使用泛型分配律，分开计算。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">ToArray</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">unknown</span> ? T[] : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">ToArray</span>&lt;<span class="built_in">string</span> | <span class="built_in">number</span>&gt; <span class="comment">// 结果是 string[] | number[]，而不是 (string | number)[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代入法计算过程</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = (<span class="built_in">string</span> <span class="keyword">extends</span> <span class="built_in">unknown</span> ? <span class="built_in">string</span>[] : <span class="built_in">never</span>) | (<span class="built_in">number</span> <span class="keyword">extends</span> <span class="built_in">unknown</span> ? <span class="built_in">number</span>[] : <span class="built_in">never</span>)</span><br></pre></td></tr></table></figure>

<p>若 <code>T</code> 为 <code>never</code>，则直接返回 <code>never</code>，不会进入条件运算。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">LikeString</span>&lt;<span class="built_in">never</span>&gt; <span class="comment">// never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">ToArray</span>&lt;<span class="built_in">never</span>&gt; <span class="comment">// never</span></span><br></pre></td></tr></table></figure>

<p>上述规则只对泛型有效，不在泛型中的联合类型和 <code>never</code>，按正常规则计算。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="built_in">never</span> <span class="keyword">extends</span> <span class="built_in">unknown</span> ? <span class="number">1</span> : <span class="number">2</span> <span class="comment">// never 空集属于 unknown 的子集，所以返回 1，不是 never</span></span><br></pre></td></tr></table></figure>

<ul>
<li>泛型中使用 <code>keyof</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">GetKeys</span>&lt;T&gt; = keyof T <span class="comment">// keyof 返回的是联合类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">GetKeys</span>&lt;<span class="title class_">Person</span>&gt; <span class="comment">// id | age | name，注，无法直接调试 Result 结果，只能通过声明变量观察结果 const r: Result = &#x27;id&#x27; </span></span><br></pre></td></tr></table></figure>

<p>在泛型中使用泛型约束 <code>extends keyof</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 key 的类型</span></span><br><span class="line"><span class="comment">// 约束 K 的类型，只能从 keyof T 中取，不可以随意传</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GetKeyType</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = T[K] <span class="comment">// type X = Person[&#x27;age&#x27;]</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">GetKeyType</span>&lt;<span class="title class_">Person</span>, <span class="string">&#x27;age&#x27;</span>&gt; <span class="comment">// number</span></span><br></pre></td></tr></table></figure>

<ul>
<li>映射类型</li>
</ul>
<p>映射类型（Mapped Types）将现有类型根据某种映射规则转换为一种新的类型。映射类型常通过 <code>keyof</code>、<code>in</code>、修饰符（<code>?</code>、<code>readonly</code>、<code>-readonly</code>、<code>-?</code>）和条件类型（Conditional Types）实现。以几种内置的工具类型 <code>Partial</code>、<code>Required</code>、<code>Record</code>、<code>Exclude</code>、<code>Extract</code>、<code>Pick</code>、<code>Omit</code> 为例，看其如何使用映射类型的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Readonly 只读属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">X1</span> = <span class="title class_">Readonly</span>&lt;<span class="title class_">Person</span>&gt;</span><br><span class="line"><span class="comment">// Readonly 实现如下</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Readonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="comment">// [K in keyof T] 表示对类型 T 的每个属性进行映射，并使用 readonly 关键字将其设为只读</span></span><br><span class="line">  <span class="comment">// 不能写成索引签名 [K: keyof T]: T[K]</span></span><br><span class="line">  <span class="keyword">readonly</span> [K <span class="keyword">in</span> keyof T]: T[K]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除 readonly，可写属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Mutable</span>&lt;T&gt; = &#123;</span><br><span class="line">  -<span class="keyword">readonly</span> [K <span class="keyword">in</span> keyof T]: T[K]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Partial 给所有属性加上可选</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Person</span>&gt;</span><br><span class="line"><span class="comment">// Partial 实现如下</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]?: T[K]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Required 必选属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Required</span>&lt;<span class="title class_">Person</span>&gt;</span><br><span class="line"><span class="comment">// Required 实现如下</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Required</span>&lt;T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]-?: T[K]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Record 用于定义对象类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;</span><br><span class="line"><span class="comment">// Record 实现如下</span></span><br><span class="line"><span class="comment">// 对象的 Key，只能有 3 种类型，需要约束</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Record</span>&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">symbol</span>, <span class="title class_">Val</span>&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> <span class="title class_">Key</span>]: <span class="title class_">Val</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Exclude 从联合类型中排除指定类型（求差集）</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Exclude</span>&lt;<span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span>, <span class="number">1</span> | <span class="number">2</span>&gt; <span class="comment">// 3</span></span><br><span class="line"><span class="comment">// Exclude 实现如下</span></span><br><span class="line"><span class="comment">// 联合类型会分开计算 </span></span><br><span class="line"><span class="comment">// 1 | 2 | 3 extends 1 | 2 会分开为 type Result = (1 extends 1 | 2 ? never : 1) | (2 extends 1 | 2 ? never : 2) | (3 extends 1 | 2 ? never : 3)</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Exclude</span>&lt;A, B&gt; = A <span class="keyword">extends</span> B ? <span class="built_in">never</span> : A</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Extract 求交集</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Extract</span>&lt;<span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span>, <span class="number">2</span> | <span class="number">4</span>&gt; <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// Extract 实现如下，为 Exclude 的反向操作</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Extract</span>&lt;A, B&gt; = A <span class="keyword">extends</span> B ? A : <span class="built_in">never</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pick 选择指定属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Pick</span>&lt;<span class="title class_">Person</span>, <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;age&#x27;</span>&gt;</span><br><span class="line"><span class="comment">// Pick 实现如下</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Pick</span>&lt;T, <span class="title class_">Key</span> <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> <span class="title class_">Key</span>]: T[K]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Omit 忽略指定属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Omit</span>&lt;<span class="title class_">Person</span>, <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;age&#x27;</span>&gt;</span><br><span class="line"><span class="comment">// Omit 实现如下</span></span><br><span class="line"><span class="comment">// 核心是 as 后的 (K extends Key ? never : K)，当前 K 在 Key 中，则删除，否则保留</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Omit</span>&lt;T, <span class="title class_">Key</span>&gt; = &#123;</span><br><span class="line">  <span class="comment">// [K in keyof T as never]: T // 断言为 never，会删除所有</span></span><br><span class="line">  <span class="comment">// [K in keyof T as &#x27;id&#x27;]: T // 断言为 id，只会保留 id</span></span><br><span class="line">  [K <span class="keyword">in</span> keyof T <span class="keyword">as</span> (K <span class="keyword">extends</span> <span class="title class_">Key</span> ? <span class="built_in">never</span> : K)]: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS 原码中通过 Pick 来实现 Omit（反向思路）</span></span><br><span class="line"><span class="comment">// Pick&lt;T, 不要的 Key&gt;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Omit</span>&lt;T, <span class="title class_">Key</span> <span class="keyword">extends</span> keyof T&gt; = <span class="title class_">Pick</span>&lt;T, <span class="title class_">Exclude</span>&lt;keyof T, <span class="title class_">Key</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="类型体操"><a href="#类型体操" class="headerlink" title="类型体操"></a>类型体操</h2><p>JavaScript 中可以对<strong>值</strong>进行各种运算（算术运算、逻辑运算、比较运算…）以及循环、判断流的程控制和函数、面向对象等高级特性，如果把 TypeScript 的类型系统当作一门语言，TypeScript 可以对<strong>类型</strong>进行各种运算以及循环、判断流程控制和泛型等高级特性。</p>
<p>以计算斐波那契数列第 n 项值为例，使用 TypeScript 类型实现和 JavaScript 解释为以下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Fibonacci</span>&lt;</span><br><span class="line">  T <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  <span class="comment">// 循环下标（数组 length 表示）</span></span><br><span class="line">  <span class="title class_">TArray</span> <span class="keyword">extends</span> <span class="title class_">ReadonlyArray</span>&lt;<span class="built_in">unknown</span>&gt; = [<span class="built_in">unknown</span>, <span class="built_in">unknown</span>, <span class="built_in">unknown</span>],</span><br><span class="line">  <span class="comment">// 前前一项值（数组 length 表示）</span></span><br><span class="line">  <span class="title class_">PrePre</span> <span class="keyword">extends</span> <span class="title class_">ReadonlyArray</span>&lt;<span class="built_in">unknown</span>&gt; = [<span class="built_in">unknown</span>],</span><br><span class="line">  <span class="comment">// 前一项值（数组 length 表示）</span></span><br><span class="line">  <span class="title class_">Pre</span> <span class="keyword">extends</span> <span class="title class_">ReadonlyArray</span>&lt;<span class="built_in">unknown</span>&gt; = [<span class="built_in">unknown</span>],</span><br><span class="line">&gt; = T <span class="keyword">extends</span> <span class="number">1</span></span><br><span class="line">  ? <span class="number">1</span></span><br><span class="line">  : T <span class="keyword">extends</span> <span class="number">2</span></span><br><span class="line">    ? <span class="number">1</span></span><br><span class="line">    : <span class="title class_">TArray</span>[<span class="string">&#x27;length&#x27;</span>] <span class="keyword">extends</span> T <span class="comment">// 如果已经循环了 T 次</span></span><br><span class="line">      ? [...<span class="title class_">Pre</span>, ...<span class="title class_">PrePre</span>][<span class="string">&#x27;length&#x27;</span>] <span class="comment">// 前两项相加</span></span><br><span class="line">      : <span class="title class_">Fibonacci</span>&lt;T, [...<span class="title class_">TArray</span>, <span class="built_in">unknown</span>], <span class="title class_">Pre</span>, [...<span class="title class_">Pre</span>, ...<span class="title class_">PrePre</span>]&gt;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Fibonacci</span>&lt;<span class="number">6</span>&gt; <span class="comment">// 8，(1 + 1 + 2 + 3 + 5 + 8)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fibonacci</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">1</span> || n === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> prePre = <span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> pre = <span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">      result = pre + prePre</span><br><span class="line">      prePre = pre</span><br><span class="line">      pre = result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fibonacci</span>(<span class="number">6</span>) <span class="comment">// 结果是 8 (1 + 1 + 2 + 3 + 5 + 8)</span></span><br></pre></td></tr></table></figure>

<p>注：TypeScript 类型体操是纯粹的函数式编程，函数式编程最基本原则是数据不可变，TypeScript 中类型一但声明就不能改变。</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/528403706/answer/2447905447">https://www.zhihu.com/question/528403706/answer/2447905447</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/fightingcat/posts">https://www.zhihu.com/people/fightingcat/posts</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/443463536">https://zhuanlan.zhihu.com/p/443463536</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/464558626">https://zhuanlan.zhihu.com/p/464558626</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/554894582">https://zhuanlan.zhihu.com/p/554894582</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/type-challenges/type-challenges">https://github.com/type-challenges/type-challenges</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/426966480?utm_id=0">https://zhuanlan.zhihu.com/p/426966480?utm_id=0</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/427309936?utm_id=0">https://zhuanlan.zhihu.com/p/427309936?utm_id=0</a></p>
<h3 id="体操的基本原理"><a href="#体操的基本原理" class="headerlink" title="体操的基本原理"></a>体操的基本原理</h3><p>TypeScript 类型体操的本质是可以对类型进行循环、判断、交叉、联合、泛型等运算和操作。</p>
<ul>
<li>循环</li>
</ul>
<p>TypeScript 中除了可以通过递归实现循环外，还可以通过分布式条件类型或映射类型实现，但它们都不能传递类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分布式条件类型</span></span><br><span class="line"><span class="comment">// 当泛型参数 T 为联合类型时，条件类型即为分布式条件类型，会将 T 中的每一项分别分发给 extends 进行比对</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Example</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">number</span> ? T : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Example</span>&lt;<span class="string">&#x27;1&#x27;</span> | <span class="string">&#x27;2&#x27;</span> | <span class="number">3</span> | <span class="number">4</span>&gt; <span class="comment">// 3 | 4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 映射类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Example</span>&lt;T <span class="keyword">extends</span> <span class="built_in">string</span> | <span class="built_in">number</span>&gt; = &#123;</span><br><span class="line">  [<span class="title class_">Key</span> <span class="keyword">in</span> T]: <span class="title class_">Key</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Example</span>&lt;<span class="string">&#x27;1&#x27;</span> | <span class="string">&#x27;2&#x27;</span> | <span class="number">3</span> | <span class="number">4</span>&gt; <span class="comment">// &#123; 1: &#x27;1&#x27;; 2: &#x27;2&#x27;; 3: 3; 4: 4; &#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>判断</li>
</ul>
<p>使用三名运算实现条件判断。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if (A &lt;= B) true else false</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="number">1</span></span><br><span class="line"><span class="keyword">type</span> B = <span class="number">1</span> | <span class="number">2</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = A <span class="keyword">extends</span> B ? <span class="literal">true</span> : <span class="literal">false</span> <span class="comment">// A 包含于 B，返回 true 否则 false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if (A &lt;= B) and (C &lt;= D) ...</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="number">1</span></span><br><span class="line"><span class="keyword">type</span> B = <span class="number">1</span> | <span class="number">2</span></span><br><span class="line"><span class="keyword">type</span> C = <span class="number">3</span></span><br><span class="line"><span class="keyword">type</span> D = <span class="number">3</span> | <span class="number">4</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = A <span class="keyword">extends</span> B </span><br><span class="line">  ? C <span class="keyword">extends</span> D </span><br><span class="line">    ? <span class="string">&#x27;true, true&#x27;</span></span><br><span class="line">    : <span class="string">&#x27;true, false&#x27;</span></span><br><span class="line">  : C <span class="keyword">extends</span> D</span><br><span class="line">    ? <span class="string">&#x27;false, true&#x27;</span></span><br><span class="line">    : <span class="string">&#x27;false, false&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断空元组</span></span><br><span class="line"><span class="keyword">type</span> A = []</span><br><span class="line"><span class="comment">// 约束 Arr 必须是一个数组</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">IsEmptyArray</span>&lt;<span class="title class_">Arr</span> <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = <span class="title class_">Arr</span>[<span class="string">&#x27;length&#x27;</span>] <span class="keyword">extends</span> <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">IsEmptyArray</span>&lt;A&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断非空元组</span></span><br><span class="line"><span class="keyword">type</span> A = []</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">IsNotEmptyArray</span>&lt;<span class="title class_">Arr</span> <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = <span class="title class_">Arr</span>[<span class="string">&#x27;length&#x27;</span>] <span class="keyword">extends</span> <span class="number">0</span> ? <span class="literal">false</span> : <span class="literal">true</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">IsNotEmptyArray</span>&lt;A&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者这样写</span></span><br><span class="line"><span class="comment">// [...infer X, infer Y] 表示至少有一个，也可写为 [...unknown[], unknown]，X、Y 相当于类型变量，加 infer 表示引用类型变量，这样就可不用写实际类型</span></span><br><span class="line"><span class="comment">// ...相当于 JS 中的 rest 运算符，...unknown[] 表示 0 个或无数个</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">IsNotEmptyArray</span>&lt;<span class="title class_">Arr</span> <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = <span class="title class_">Arr</span> <span class="keyword">extends</span> [...infer X, infer Y] ? <span class="literal">true</span> : <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>递归</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反转元组</span></span><br><span class="line"><span class="keyword">type</span> A = [<span class="string">&#x27;ji&#x27;</span>, <span class="string">&#x27;ni&#x27;</span>, <span class="string">&#x27;tai&#x27;</span>, <span class="string">&#x27;mei&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Reverse</span>&lt;<span class="title class_">Arr</span> <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = <span class="title class_">Arr</span> <span class="keyword">extends</span> [...infer <span class="title class_">Rest</span>, infer <span class="title class_">Last</span>]</span><br><span class="line">  ? [<span class="title class_">Last</span>, ...<span class="title class_">Reverse</span>&lt;<span class="title class_">Rest</span>&gt;]</span><br><span class="line">  : <span class="title class_">Arr</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Reverse</span>&lt;A&gt; <span class="comment">// [&#x27;mei&#x27;, &#x27;tai&#x27;, &#x27;ni&#x27;, &#x27;ji&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>注：经测试，元组递归的层数最多 <code>48</code> 层，普通对象的层数限制未测出。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未知层数的对象类型属性添加 readonly</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">DeepReadonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: <span class="title class_">DeepReadonly</span>&lt;T[P]&gt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SomeObject</span> &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">b</span>: &#123;</span><br><span class="line">      <span class="attr">c</span>: <span class="built_in">number</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj</span>: <span class="title class_">DeepReadonly</span>&lt;<span class="title class_">SomeObject</span>&gt; = &#123;<span class="attr">a</span>: &#123;<span class="attr">b</span>: &#123;<span class="attr">c</span>: <span class="number">2</span>&#125;&#125;&#125;</span><br><span class="line">obj.<span class="property">a</span>.<span class="property">b</span>.<span class="property">c</span> = <span class="number">23</span> <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<ul>
<li>比较运算</li>
</ul>
<p>TypeScript 中没有 <code>==</code>，但是通过 <code>extends</code> 可以实现类似的效果。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">EqEq</span>&lt;<span class="variable constant_">T1</span>, <span class="variable constant_">T2</span>&gt; = [<span class="variable constant_">T1</span>] <span class="keyword">extends</span> [<span class="variable constant_">T2</span>] </span><br><span class="line">  ? ([<span class="variable constant_">T2</span>] <span class="keyword">extends</span> [<span class="variable constant_">T1</span>] ? <span class="literal">true</span> : <span class="literal">false</span>) </span><br><span class="line">  : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result1</span> = <span class="title class_">EqEq</span>&lt;<span class="number">5</span>, <span class="number">10</span>&gt;;  <span class="comment">// false</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result2</span> = <span class="title class_">EqEq</span>&lt;<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;abc&quot;</span>&gt;;  <span class="comment">// true</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result3</span> = <span class="title class_">EqEq</span>&lt;<span class="literal">true</span>, <span class="literal">false</span>&gt;;  <span class="comment">// false</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result4</span> = <span class="title class_">EqEq</span>&lt;<span class="built_in">never</span>, <span class="built_in">never</span>&gt;;  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>模式匹配和 infer 引用</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Tuple</span> = [<span class="string">&#x27;ji&#x27;</span>, <span class="string">&#x27;ni&#x27;</span>, <span class="string">&#x27;tai&#x27;</span>, <span class="string">&#x27;mei&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result1</span> = <span class="title class_">Tuple</span> <span class="keyword">extends</span> [infer <span class="title class_">First</span>, ...infer <span class="title class_">Rest</span>] ? <span class="title class_">First</span> : <span class="built_in">never</span> <span class="comment">// &#x27;ji&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result2</span> = <span class="title class_">Tuple</span> <span class="keyword">extends</span> [infer <span class="title class_">First</span>, ...infer <span class="title class_">Rest</span>] ? <span class="title class_">Rest</span> : <span class="built_in">never</span> <span class="comment">// [&#x27;ni&#x27;, &#x27;tai&#x27;, &#x27;mei&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="元组的基本体操"><a href="#元组的基本体操" class="headerlink" title="元组的基本体操"></a>元组的基本体操</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展元组</span></span><br><span class="line"><span class="keyword">type</span> A = [<span class="number">1</span>]</span><br><span class="line"><span class="keyword">type</span> B = [...A, <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取元组最后一项</span></span><br><span class="line"><span class="keyword">type</span> A = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Last</span>&lt;T <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = T <span class="keyword">extends</span> [...<span class="built_in">unknown</span>[], infer <span class="title class_">Last</span>] ? <span class="title class_">Last</span> : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Last</span>&lt;A&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能用 JS 的思维实现，下面这样是错的</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Last</span>&lt;T <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = T[T[<span class="string">&#x27;length&#x27;</span>] - <span class="number">1</span>] <span class="comment">// TS 中没有提供减法操作，4 - 1 在 TS 中无法计算</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取元组除了最后一项的其他项</span></span><br><span class="line"><span class="keyword">type</span> A = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">NotLast</span>&lt;T <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = T <span class="keyword">extends</span> [...infer X, <span class="built_in">unknown</span>] ? X : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">NotLast</span>&lt;A&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能用 JS 的思维实现，下面这样是错的</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Last</span>&lt;T <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = T[T[<span class="string">&#x27;length&#x27;</span>] - <span class="number">1</span>] <span class="comment">// TS 中没有提供减法操作，4 - 1 在 TS 中无法计算</span></span><br></pre></td></tr></table></figure>

<h3 id="字符串的基本体操"><a href="#字符串的基本体操" class="headerlink" title="字符串的基本体操"></a>字符串的基本体操</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大小写切换</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="string">&#x27;tracy&#x27;</span></span><br><span class="line"><span class="keyword">type</span> B = <span class="title class_">Capitalize</span>&lt;A&gt; <span class="comment">// &#x27;Tracy&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> C = <span class="string">&#x27;ji&#x27;</span> | <span class="string">&#x27;ni&#x27;</span> | <span class="string">&#x27;tai&#x27;</span> | <span class="string">&#x27;mei&#x27;</span></span><br><span class="line"><span class="keyword">type</span> D = <span class="title class_">Capitalize</span>&lt;C&gt; <span class="comment">// 联合类型在泛型中会按分配律计算，结果为 &#x27;Ji&#x27; | &#x27;Ni&#x27; | &#x27;Tai&#x27; | &#x27;Mei&#x27;</span></span><br></pre></td></tr></table></figure>

<p>除了 <code>Capitalize</code> 首字母大写外，TypeScript 还内置了 <code>Uppercase</code> 全变成大写，<code>Uncapitalize</code> 首字母小写，<code>Lowercase</code> 全变成小写。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模板字符串</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="string">&#x27;ji&#x27;</span></span><br><span class="line"><span class="keyword">type</span> B = <span class="string">&#x27;ni&#x27;</span></span><br><span class="line"><span class="keyword">type</span> C = <span class="string">&#x27;tai&#x27;</span></span><br><span class="line"><span class="keyword">type</span> D = <span class="string">&#x27;mei&#x27;</span></span><br><span class="line"><span class="keyword">type</span> X = <span class="string">`<span class="subst">$&#123;A&#125;</span> <span class="subst">$&#123;B&#125;</span> <span class="subst">$&#123;C&#125;</span> <span class="subst">$&#123;D&#125;</span>`</span> <span class="comment">// &#x27;ji ni tai mei&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转字符串</span></span><br><span class="line"><span class="comment">// 将类型转为字符串有一定的限制，仅支持下面的类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">CanStringified</span> = <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">bigint</span> | <span class="built_in">boolean</span> | <span class="literal">null</span> | <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// 将支持的类型转化为字符串</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Stringify</span>&lt;T <span class="keyword">extends</span> <span class="title class_">CanStringified</span>&gt; = <span class="string">`<span class="subst">$&#123;T&#125;</span>`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result1</span> = <span class="title class_">Stringify</span>&lt;<span class="number">0</span>&gt; <span class="comment">// &#x27;0&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result2</span> = <span class="title class_">Stringify</span>&lt;-<span class="number">1</span>&gt; <span class="comment">// &#x27;-1&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result3</span> = <span class="title class_">Stringify</span>&lt;<span class="number">0.1</span>&gt; <span class="comment">// &#x27;0.1&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result4</span> = <span class="title class_">Stringify</span>&lt;<span class="string">&#x27;0.2&#x27;</span>&gt; <span class="comment">// &#x27;0.2&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取第一个字符</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="string">&#x27;ji ni tai mei&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">First</span>&lt;T <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = T <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer F&#125;</span><span class="subst">$&#123;<span class="built_in">string</span>&#125;</span>`</span> ? F : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">First</span>&lt;A&gt; <span class="comment">// &#x27;j&#x27;</span></span><br></pre></td></tr></table></figure>

<p>注：使用模式匹配只能获取第一个字符和其它剩下字符，不能获取最后一个字符，如果想要获取最后一个字符，可转为元组操作。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取最后一个字符</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="string">&#x27;ji ni tai mei&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LastOfTuple</span>&lt;T <span class="keyword">extends</span> <span class="built_in">unknown</span>[]&gt; = T <span class="keyword">extends</span> [...infer _, infer L] ? L : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">StringToTuple</span>&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer F&#125;</span><span class="subst">$&#123;infer R&#125;</span>`</span></span><br><span class="line">  ? [F, ...<span class="title class_">StringToTuple</span>&lt;R&gt;]</span><br><span class="line">  : []</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LastOfString</span>&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = <span class="title class_">LastOfTuple</span>&lt;<span class="title class_">StringToTuple</span>&lt;S&gt;&gt;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">LastOfString</span>&lt;A&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串转联合类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">StringToUnion</span>&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer First&#125;</span><span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">  ? <span class="title class_">First</span> | <span class="title class_">StringToUnion</span>&lt;<span class="title class_">Rest</span>&gt;</span><br><span class="line">  : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">StringToUnion</span>&lt;<span class="string">&#x27;jinitaimei&#x27;</span>&gt; <span class="comment">// &quot;j&quot; | &quot;i&quot; | &quot;n&quot; | &quot;t&quot; | &quot;a&quot; | &quot;m&quot; | &quot;e&quot;，联合类型会自动去重</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串转元组</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">StringToTuple</span>&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer First&#125;</span><span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">  ? [<span class="title class_">First</span>, ...<span class="title class_">StringToTuple</span>&lt;<span class="title class_">Rest</span>&gt;]</span><br><span class="line">  : []</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">StringToTuple</span>&lt;<span class="string">&#x27;jinitaimei&#x27;</span>&gt; <span class="comment">// [&quot;j&quot;, &quot;i&quot;, &quot;n&quot;, &quot;i&quot;, &quot;t&quot;, &quot;a&quot;, &quot;i&quot;, &quot;m&quot;, &quot;e&quot;, &quot;i&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="Type-Challenges"><a href="#Type-Challenges" class="headerlink" title="Type-Challenges"></a>Type-Challenges</h3><p><a target="_blank" rel="noopener" href="https://github.com/type-challenges/type-challenges/blob/main/README.zh-CN.md#%E4%BB%8B%E7%BB%8D">Type-Challenges</a> 中常见问题解法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0004 Pick</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Pick</span>&lt;T, <span class="title class_">Key</span> <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> <span class="title class_">Key</span>]: T[K]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Pick</span>&lt;&#123;<span class="attr">a</span>: <span class="number">1</span>; <span class="attr">b</span>: <span class="number">2</span>; <span class="attr">c</span>: <span class="number">3</span>&#125;, <span class="string">&#x27;a&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可使用代入法来思考泛型</span></span><br><span class="line">&#123;</span><br><span class="line">  [K <span class="keyword">in</span> <span class="string">&#x27;a&#x27;</span>]: &#123;<span class="attr">a</span>: <span class="number">1</span>; <span class="attr">b</span>: <span class="number">2</span>; <span class="attr">c</span>: <span class="number">3</span>&#125;[<span class="string">&#x27;a&#x27;</span>] <span class="comment">// 即 &#x27;a&#x27;: 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3321 Parameters</span></span><br><span class="line"><span class="comment">// 获取函数参数类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Parameters</span>&lt;F <span class="keyword">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>&gt; = F <span class="keyword">extends</span> (...<span class="attr">args</span>: infer X) =&gt; <span class="built_in">any</span> ? X : <span class="built_in">never</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo = (<span class="attr">arg1</span>: <span class="built_in">string</span>, <span class="attr">arg2</span>: <span class="built_in">number</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span> = <span class="title class_">Parameters</span>&lt;<span class="keyword">typeof</span> foo&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0189 Awaited</span></span><br><span class="line"><span class="comment">// 获取 Promise resove 的数据类型</span></span><br><span class="line"><span class="comment">// 注意，不能直接使用 Promise 类型，否则 Thenable 用例不能通过</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Awaited</span>&lt;P <span class="keyword">extends</span> <span class="title class_">PromiseLike</span>&lt;<span class="built_in">any</span>&gt;&gt; = P <span class="keyword">extends</span> <span class="title class_">PromiseLike</span>&lt;infer X&gt;</span><br><span class="line">  ? X <span class="keyword">extends</span> <span class="title class_">PromiseLike</span>&lt;<span class="built_in">any</span>&gt; </span><br><span class="line">    ? <span class="title class_">Awaited</span>&lt;X&gt; </span><br><span class="line">    : X</span><br><span class="line">  : <span class="built_in">never</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4471 Zip</span></span><br><span class="line"><span class="comment">// 像拉拉链一样将元组交叉组合</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Zip</span>&lt;A <span class="keyword">extends</span> <span class="built_in">any</span>[], B <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = A <span class="keyword">extends</span> [infer <span class="title class_">AFirst</span>, ...infer <span class="title class_">ARest</span>]</span><br><span class="line">  ? B <span class="keyword">extends</span> [infer <span class="title class_">BFirst</span>, ...infer <span class="title class_">BRest</span>]</span><br><span class="line">    ? [[<span class="title class_">AFirst</span>, <span class="title class_">BFirst</span>], ...<span class="title class_">Zip</span>&lt;<span class="title class_">ARest</span>, <span class="title class_">BRest</span>&gt;]</span><br><span class="line">      : []</span><br><span class="line">    : []</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4484 IsTuple</span></span><br><span class="line"><span class="comment">// 判断是否为元组</span></span><br><span class="line"><span class="comment">// 元组的长度是固定的，length 返回固定值，而数组长度是不固定的，length 返回 number</span></span><br><span class="line"><span class="comment">// 泛型中的 never 会直接返回 never，为了使其返回 true false，这里使用 [] 包裹，当然使用 &#123;&#125; 或函数类型包裹效果也一样</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">IsTuple</span>&lt;T&gt; = [T] <span class="keyword">extends</span> [<span class="built_in">never</span>] </span><br><span class="line">  ? <span class="literal">false</span></span><br><span class="line">  : T <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[]</span><br><span class="line">    ? <span class="built_in">number</span> <span class="keyword">extends</span> T[<span class="string">&#x27;length&#x27;</span>] <span class="comment">// 如果是数组则返回 false</span></span><br><span class="line">      ? <span class="literal">false</span></span><br><span class="line">      : <span class="literal">true</span></span><br><span class="line">    :<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5310 Join</span></span><br><span class="line"><span class="comment">// 将元组使用分隔符连接成字符串</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Join</span>&lt;T <span class="keyword">extends</span> <span class="built_in">string</span>[], U <span class="keyword">extends</span> <span class="built_in">string</span> | <span class="built_in">number</span>&gt; = T <span class="keyword">extends</span> [infer <span class="title class_">First</span> <span class="keyword">extends</span> <span class="built_in">string</span>, ...infer <span class="title class_">Rest</span> <span class="keyword">extends</span> <span class="built_in">string</span>[]]</span><br><span class="line">  ? <span class="title class_">Rest</span>[<span class="string">&#x27;length&#x27;</span>] <span class="keyword">extends</span> <span class="number">0</span></span><br><span class="line">    ? <span class="title class_">First</span></span><br><span class="line">    : <span class="string">`<span class="subst">$&#123;First&#125;</span><span class="subst">$&#123;U&#125;</span><span class="subst">$&#123;Join&lt;Rest, U&gt;&#125;</span>`</span></span><br><span class="line">  : <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="d-ts-类型声明文件"><a href="#d-ts-类型声明文件" class="headerlink" title=".d.ts 类型声明文件"></a>.d.ts 类型声明文件</h2><p><code>.d.ts</code> (Declaration files) 是用来描述 JavaScript 代码对外接口和标准库的类型信息文件。当在 TypeScript 项目中引入第三方 JavaScript 库或自己的 JavaScript 代码时，这些 JavaScript 代码不包含类型信息，通过 <code>.d.ts</code>，为这些代码提供类型定义，实现代码补全、接口提示和编译时静态类型检查。<code>.d.ts</code> 不包含具体实现，只包含类型信息。</p>
<h3 id="d-ts-来源"><a href="#d-ts-来源" class="headerlink" title=".d.ts 来源"></a>.d.ts 来源</h3><p><code>.d.ts</code> 有 4 种来源：TypeScript 内置的标准库 <code>.d.ts</code>、第三方源码中的 <code>.d.ts</code>、第三方在 <code>@types</code> (<a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a> 维护) 中的 <code>.d.ts</code>、项目内 <code>.d.ts</code>。全局自动引用可通过 tsconfig.json 设置，其中 <code>lib</code> 设置标准库 <code>.d.ts</code> 引用、<code>types</code> 设置 <code>@types</code> <code>.d.ts</code> 引用、<code>include</code> 设置项目内 <code>.d.ts</code>，文件内引用可使用 <code>reference</code> 或 ES Module。</p>
<ul>
<li>标准库类型声明文件</li>
</ul>
<p>EcmaScript 标准库类型、DOM 标准库类型在 <a target="_blank" rel="noopener" href="https://github.com/microsoft/TypeScript/tree/main/src/lib">TypeScript 中已经内置</a> 。可在 tsconfig.json <code>lib</code> 中引用。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>ESNext</code> 是 EcmaScript 标准库类型，<code>ESNext</code> 是最全的，也可以设为 <code>ES5</code>、<code>ES2015</code>…，<code>DOM</code> 是 DOM 标准库类型。</p>
<p>需要注意的是，NodeJS 标准库的类型声明文件在 <code>@types</code> 中，TypeScript 没有内置，需要安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @types/node@18</span><br></pre></td></tr></table></figure>

<ul>
<li>第三方库的类型声明文件</li>
</ul>
<p>用 TypeScirpt 开发的项目自带类型，以 JS 源码交付时会带上声明文件，并按一定规则指定声明文件，以此来告诉 TypeScript 编译器在引用该包时应该使用哪个文件来获取类型信息。</p>
<p>声明文件的指定规则需要满足以下之一，才能被正确的识别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 在 pageage.json 中 types（或 typings） 字段指明声明文件路径</span><br><span class="line">* 在项目根目录下编写一个 index.d.ts 文件</span><br><span class="line">* 将声明文件命名为与 main 入口文件同名不同后缀的 .d.ts 文件</span><br></pre></td></tr></table></figure>

<p>而很多流行的 JavaScript 开发项目，<code>@types</code> 中也有相应的 <code>.d.ts</code>。以 React 为例，React 通过 JS 开发的，源码中没有类型，需要单独安装类型（与之对应的 Vue3 则是 TS 开发，自带声明文件）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @types/react@18</span><br></pre></td></tr></table></figure>

<p>注：tsconfig.json <code>types</code> 属性用于控制 <code>@types</code> 下声明文件的引用，未配置时，<code>@types</code> 下的所有声明文件都会被自动加载，可配置此属性，按需引用。</p>
<ul>
<li>项目内的类型声明文件</li>
</ul>
<p>项目内的 .d.ts 用来为 JavaScript 代码补充类型，需要开发者手动编写（参考 d.ts 编写）。以 Vite + Vue3 + TS 为例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// env.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 Vite 提供的类型</span></span><br><span class="line"><span class="comment">// Vite 默认的类型定义是写给它的 Node.js API 的（package.json types 指向 &quot;./dist/node/index.d.ts&quot;），客户端类型需要手动引入，其中定义了许多文件类型，比如 svg、css、png...，不导入这个类型文件，会导致 import 这些文件时会报错</span></span><br><span class="line"><span class="comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明单文件组件的类型</span></span><br><span class="line"><span class="comment">// 默认情况下 TS 编译器只能识别 .js、.ts、.tsx，对于 .vue、.css、.png...，则需要声明其类型，否则引入时会报错</span></span><br><span class="line"><span class="comment">// VSCode 下配合 Volar 插件，可以不声明，Volar 能让 TS server 识别 *.vue 文件，但为了普式性，还是建议声明</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;*.vue&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> &#123;<span class="title class_">DefineComponent</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line">  <span class="comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/ban-types</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">component</span>: <span class="title class_">DefineComponent</span>&lt;&#123;&#125;, &#123;&#125;, <span class="built_in">any</span>&gt;;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> component;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展 ImportMetaEnv 类型</span></span><br><span class="line"><span class="comment">// 比如 import.meta.env.VITE_API_BASE_URL </span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">interface</span> <span class="title class_">ImportMetaEnv</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">VITE_API_BASE_URL</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>tsconfig.json <code>includes</code> 属性用来指定哪些 <code>ts</code> 文件需要编译，包括项目内 d.ts。以 Vue3 为例，其配置如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;src/**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;src/**/*.vue&quot;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>上述配置中，<code>src</code> 目录下的所有 <code>ts</code> 文件和 <code>vue</code> 文件都会被 TypeScript 编译器编译，包括 global.d.ts、env.d.ts 这些项目内 d.ts，也会自动引入，全局生效。如果这些 d.ts 放在与 <code>src</code> 平行的 <code>types</code> 目录，则需将 <code>includes</code> 配置为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;src/**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;src/**/*.vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;types/*.d.ts&quot;</span>     </span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="d-ts-编写"><a href="#d-ts-编写" class="headerlink" title=".d.ts 编写"></a>.d.ts 编写</h3><p><code>declare</code> 用于声明变量、函数、类、命名空间或模块…的类型。<code>declare</code> 可省略，但对于 <code>variable</code>、<code>function</code>、<code>class</code> 这些值相关代码，应保留，明确指定此处用于类型声明，而不是实现。</p>
<p><code>reference</code> 用来引入类型声明文件，其中 <code>lib</code> 用来引用 TS 内置标准库声明文件（等同于 tsconfig.json 中 <code>lib</code> 属性），<code>path</code> 用来引用本地声明文件、<code>types</code> 用来引用 <code>@types</code> 中的声明文件。绝大多数情况下可用 ES Module <code>import</code> 代替，但在导入全局变量类型（全局类型不允许使用 <code>import</code> 导入），编写依赖外部类型的全局变量声明文件（用 <code>import</code> 导入外部类型，会使全局类型变成模块类型），拆分声明文件，这些场景中还发挥着作用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拆分声明文件</span></span><br><span class="line"><span class="comment">// 以 nodejs 的类型声明文件 `@types/node/index.d.ts` 为例</span></span><br><span class="line"><span class="comment">/// &lt;reference lib=&quot;es2020&quot;&gt;</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;fs.d.ts&quot;&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>声明全局变量、函数、类、对象的类型</li>
</ul>
<p><code>declare variable</code> (<code>var</code>、<code>let</code>、<code>const</code>)、<code>declare function</code>、<code>declare class</code>、<code>declare namespace</code> 为 <code>&lt;script&gt;</code> 标签注入的全局变量、函数、class、对象声明类型。<code>declare</code> 可以省略，文件名一般为 global.d.ts。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局变量</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">let</span> <span class="attr">jQuery</span>: <span class="function">(<span class="params">selector: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局函数</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> <span class="title function_">jQuery</span>(<span class="params">selector: <span class="built_in">string</span></span>): <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局 class</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>);</span><br><span class="line">  <span class="title function_">sayHi</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局对象</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> jQuery &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">url: <span class="built_in">string</span>, settings?: <span class="built_in">any</span></span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：在全局变量的声明文件中，不允许出现 <code>import</code> 或 <code>export</code> 关键字，否则 .d.ts 会被视为一个 ES Module 或 UMD 模块的声明文件，不是全局变量的声明文件。如果全局变量的声明文件需要引用另一个库的类型，可以使用三斜线指令，或者使用 <code>declare global</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">RouteMeta</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Component 在外部不可用</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Component</span>&lt;T = <span class="built_in">any</span>&gt; =</span><br><span class="line">  | <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> defineComponent&gt;</span><br><span class="line">  | (<span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="keyword">typeof</span> <span class="title function_">import</span>(<span class="string">&#x27;*.vue&#x27;</span>)&gt;)</span><br><span class="line">  | (<span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;T&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">global</span> &#123;</span><br><span class="line">  <span class="comment">// declare 可省略</span></span><br><span class="line">  <span class="keyword">declare</span> <span class="keyword">interface</span> <span class="title class_">AppRouteRecordRaw</span> &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="built_in">string</span>;</span><br><span class="line">    redirect?: <span class="built_in">string</span>;</span><br><span class="line">    component?: <span class="title class_">Component</span> | <span class="built_in">string</span>;</span><br><span class="line">    children?: <span class="title class_">AppRouteRecordRaw</span>[];</span><br><span class="line">    meta?: <span class="title class_">RouteMeta</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>声明模块的类型</li>
</ul>
<p>导入 JS 模块（ES Module 或 UMD、CommonJS）时，如果没有声明文件，会提示 <code>Could not find a declaration file for module...</code> 错误，可以使用 <code>declare module</code> 为模块声明类型。</p>
<p>npm 模块：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">jQuery</span>: <span class="function">(<span class="params">selector: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;jquery&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> jQuery;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：模块的声明文件只有 <code>export</code> 导出的类型声明才能被导入。</p>
<p>项目内模块：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module 名为 import 时的名称</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;@/core/utils/tracy&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">tracy</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">sayHi</span>: <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">export</span> &#123; sayHi &#125;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> tracy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tracy.js</span></span><br><span class="line"><span class="keyword">const</span> tracy = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;tracy&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sayHi</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hi, <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; sayHi &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> tracy</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> tracy <span class="keyword">from</span> <span class="string">&#x27;@/core/utils/tracy&#x27;</span></span><br></pre></td></tr></table></figure>

<p>图片等模块：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;*.jpg&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">src</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> src</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：也可不使用 <code>declare module</code>，将 <code>.d.ts</code> 名与模块名相同，放同一目录。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tracy.d.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">tracy</span>: &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">sayHi</span>: <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; sayHi &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> tracy</span><br></pre></td></tr></table></figure>

<p>第三方 npm 模块也可使用这种方法，但是需要在项目里面用 JS 包一层，因为 <code>.d.ts</code> 不能直接与第三方关联。以 react 为例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// react.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 包裹一层，JS 可以 `import` JS</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// react.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明文件和包裹层需放一起</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">React</span>: &#123;</span><br><span class="line">  <span class="attr">createElement</span>: <span class="function">(<span class="params">tag: <span class="built_in">string</span>, props: <span class="built_in">any</span>, ...children: <span class="built_in">any</span>[]</span>) =&gt;</span> <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 现在就可以使用了</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;./react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">createElement</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li>声明全局类型</li>
</ul>
<p>一般使用 types.d.ts 管理全局类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// types.d.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">LocaleType</span> = <span class="string">&#x27;zh-CN&#x27;</span> | <span class="string">&#x27;en&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IPageInfo</span> &#123;</span><br><span class="line">  <span class="attr">curPage</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">pageSize</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">total</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IPageData</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">page</span>: <span class="title class_">IPageInfo</span></span><br><span class="line">  <span class="attr">items</span>: T[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：项目内 d.ts 是用来为 JS 代码中已存在的对外的接口（变量、函数、类……）补充类型标注，个人不推荐用来声明通用的全局类型，自动引入会使依赖不明确，影响代码的可维护性和可读性，TS 的类型最好在 <code>ts</code> 文件中声明。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PageInfo</span> &#123;</span><br><span class="line">  <span class="attr">curPage</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">pageSize</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">total</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PageData</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">page</span>: <span class="title class_">PageInfo</span>;</span><br><span class="line">  <span class="attr">items</span>: T[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>扩展全局变量</li>
</ul>
<p><code>declare global</code> 扩展全局变量。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global.d.ts</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">global</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="title function_">foo</span>(): <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.ts</span></span><br><span class="line"><span class="string">&#x27;bar&#x27;</span>.<span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure>

<h3 id="d-ts-生成"><a href="#d-ts-生成" class="headerlink" title=".d.ts 生成"></a>.d.ts 生成</h3><p>.d.ts 可通过 <code>tsc --declaration</code> (或 tsconfig 配置 <code>&quot;declaration&quot;: true</code>)、<a target="_blank" rel="noopener" href="https://github.com/microsoft/DefinitelyTyped-tools/tree/main/packages/dts-gen">dts-gen</a>、<a target="_blank" rel="noopener" href="https://github.com/ConquestArrow/dtsmake">dtsmake</a> 自动生成。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.ts</span></span><br><span class="line"><span class="keyword">type</span> A = <span class="built_in">string</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: A = <span class="string">&#x27;hi&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型需要导出，否则声明文件中没有</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> &#123; A &#125;</span><br><span class="line"><span class="keyword">export</span> &#123; a &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为 TS 文件生成 d.ts</span></span><br><span class="line">tsc -d test.ts</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为已安装 npm 包生成 d.ts</span></span><br><span class="line">dts-gen -m moment</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为单个 JS 文件生成 d.ts</span></span><br><span class="line">tsc -d test.js --allowJs</span><br></pre></td></tr></table></figure>

<h2 id="TSX"><a href="#TSX" class="headerlink" title="TSX"></a>TSX</h2><p>随着 React 的流行，JSX 已然成为了一种标准，TypeScript 从 <a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-1-6.html">1.6</a> 开始便对其进行了<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/jsx.html">支持</a>，支持在 JS 中内嵌 JSX，类型检查以及直接编译为  JavaScript。只需将文件扩展名为 <code>.tsx</code>，启用 <code>jsx</code> 编译选项，便可开启 JSX 的支持。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloWorld.tsx</span></span><br><span class="line"><span class="comment">// 注意，需要安装 JSX 类型声明文件 (以 React 为例，`npm i @types/react -D`)，否则 `tsc` 编译时会报类型错误</span></span><br><span class="line"><span class="keyword">const</span> element = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令行编译</span></span><br><span class="line"><span class="comment"># 如果不使用 --jsx 选项，则会提示 Cannot use JSX unless the &#x27;--jsx&#x27; flag is provided 错误</span></span><br><span class="line">tsc --jsx react HelloWorld.tsx <span class="comment"># --jsx 支持多个配置，Vue3 中用的是 preserve</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 编译结果</span></span><br><span class="line"><span class="keyword">var</span> element = <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;Hello, world!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>注：在实际项目中一般使用 <code>tsconfig.json</code> 配置编译选项，它不但提供了打包时的 <code>tsc</code> 的编译选项，还提供了 IDE 内置 <code>tsc</code> 的编译选项，VSCode、WebStorm …内置的 <code>tsc</code> 会读取 <code>tsconfig.json</code>，提供代码提示、错误检查等功能。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>禁用尖括号断言</li>
</ul>
<p>为了避免与 JSX 冲突，TSX 中禁止使用尖括号来做类型断言，应使用 <code>as</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = &lt;foo&gt;bar</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">const</span> foo = bar <span class="keyword">as</span> foo</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/619667111">https://zhuanlan.zhihu.com/p/619667111</a></p>
<h2 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a>tsconfig.json</h2><p><a href="/rep/javascript/tsconfig.html"><code>tsconfig.json</code></a>  是 TS 编译器的配置文件，用来指定待编译文件和定义编译选项，可使用 <code>tsc --init</code> 自动生成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc file1.ts file2.ts --outFile dist/app.js</span><br></pre></td></tr></table></figure>

<p>上面命令行参数写成 tsconfig.json 结果如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;file1.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;file2.ts&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;outFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dist/app.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>tsconfig.json</code> 所在的目录是 TypeScript 项目的根目录，当不带任何输入文件的情况下调用 <code>tsc</code>，编译器会从当前目录开始去查找 <code>tsconfig.json</code> 文件，逐级向上搜索父目录。</p>
<p>tsconfig.json 是 tsc 代码编译的配置，.eslintrc.cjs 或 tslint.json 是代码检查配置。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>*《TypeScript编程》<br>*《编程与类型系统》使用 TypeScript 描述<br>*《类型和程序设计语言》TAPL</p>

    </div>

    

    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-about">
                <h2>About</h2>
                <p>
                    愿你走出半生，归来仍是少年
                </p>
            </div>
            
<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-categories">
    <h2>Categories</h2>
    <p>
        
        <a class="footer-post" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
        
        <a class="footer-post" href="/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/">可视化</a>
        
        <a class="footer-post" href="/categories/%E5%B0%91%E5%84%BF%E7%BC%96%E7%A8%8B/">少儿编程</a>
        
        <a class="footer-post" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a>
        
    </p>
</div>

            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-search">
    <h2>Search</h2>
    <form class="site-search-form">
        <input type="text" id="local-search-input" class="st-search-input" />
    </form>
    <div id="local-search-result" class="local-search-result-cls"></div>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    Copyright©Tracy-xu'Blog. All Rights Reserved.
                </div>
            </div>
        </div>
    </div>
</footer>


<!-- After footer scripts -->

<!-- jQuery -->
<script src="/plugins/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="/plugins/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="/plugins/featherlight/featherlight.min.js"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>
