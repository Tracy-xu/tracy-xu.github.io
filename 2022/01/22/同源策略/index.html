<!-- build time:Wed Aug 17 2022 14:44:45 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Tracy-xu&#39;Blog"><meta name="author" content="Tracy Xu"><meta property="og:title" content="Tracy-xu&#39;Blog"><meta property="og:description" content="Tracy-xu&#39;Blog"><meta property="og:site_name" content="Tracy-xu&#39;Blog"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><title>Tracy-xu&#39;Blog</title><link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css" type="text/css"><link href="/plugins/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet"><link href="/plugins/featherlight/featherlight.min.css" type="text/css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"></head><body><div class="bg-gradient"></div><div class="bg-pattern"></div><div class="menu-bg"><div class="menu-container"><ul><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/about.html">关于我</a></li></ul></div></div><nav><a href="#menu"></a></nav><div class="container"><div class="row"><div class="col-sm-12"><header><div class="logo"><a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a></div></header><section class="main"><div class="post"><div class="post-header"><h1 class="title"><a href="/2022/01/22/同源策略/">Untitled</a></h1><div class="post-info"><span class="date">2022-01-22</span></div></div><div class="content"><p><a href="https://www.secpulse.com/archives/63801.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/63801.html</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy</a><br><a href="https://blog.csdn.net/qq_28773159/article/details/104834167" target="_blank" rel="noopener">https://blog.csdn.net/qq_28773159/article/details/104834167</a><br><a href="https://www.zhihu.com/question/20138568" target="_blank" rel="noopener">https://www.zhihu.com/question/20138568</a><br><a href="https://www.cnblogs.com/wuyongyin/archive/2021/06/12/14817142.html" target="_blank" rel="noopener">https://www.cnblogs.com/wuyongyin/archive/2021/06/12/14817142.html</a><br><a href="https://blog.csdn.net/weixin_42394911/article/details/119895911" target="_blank" rel="noopener">https://blog.csdn.net/weixin_42394911/article/details/119895911</a></p><p>同源策略</p><p>同源策略（Same-origin policy）是一种约定，它是浏览器最核心也最基本的安全功能，它用于限制一个源加载的文档或脚本如何与另一个源加载的资源进行交互。如果缺少了同源策略，浏览器很容易受到 XSS、CSRF 的攻击。</p><ul><li>同源</li></ul><p>所谓同源是指”协议（protocol） + 域名（host） + 端口（port）”三者相同。</p><ul><li>源的继承</li></ul><p>在页面中通过 about:blank 或 javascript: URL 执行的脚本会继承打开该 URL 的文档的源。</p><ul><li>源的更改</li></ul><p>满足某些限制条件的情况下，页面可以通过 document.domain 来修改源（修改为当前域或其当前域的父域）。可用来处理 iframe 跨子域问题。</p><p>浏览器会根据同源策略允许或拒绝请求某些资源</p><p>页面跨域的行为主要会分为三类，分别是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cross-origin embedding 跨域资源嵌入</span><br><span class="line">Cross-origin writes 跨域写操作</span><br><span class="line">Cross-origin reads 跨域读操作</span><br></pre></td></tr></table></figure><p>跨域资源嵌入，比如 script、link、image、video、audio、object、embed、applet、iframe、@font-face（也有浏览器不允许跨域字体）。这些请求都不带 cookie，所以是安全的。<br>跨域写操作，比如 links，重定向以及 form 表单提交。<br>跨域读操作，比如 BOM（DOM，cookie，localStorage，indexDB）、资源（Ajax，drawImage）。</p><p>在这三种行为之中，通常情况下只有 Cross-origin read 是不被允许跨域的，其余的两种是允许的。</p><p>跨域的几种形式：跨主域、跨子域、跨端口、跨协议</p><h3 id="禁止跨域"><a href="#禁止跨域" class="headerlink" title="禁止跨域"></a>禁止跨域</h3><p>其实跨域请求本身并没有任何的安全隐患， 有安全隐患的是请求 X 网站的时候会顺便带上 X 网站的 cookie</p><p>Ajax 的同源策略主要用来防止 CSRF 攻击的，<br>BOM 的同源策略第一是为了防止父或子页面内容被串改，最重要的还是安全。</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>CORS (跨源资源共享) 要服务器和浏览器同时支</p><h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><h3 id="反代"><a href="#反代" class="headerlink" title="反代"></a>反代</h3><p>proxy</p><h3 id="document-domain"><a href="#document-domain" class="headerlink" title="document.domain"></a>document.domain</h3><p>用来解决 iframe 跨子域时的 BOM 访问。</p><p>利用 document.domain 实现跨域，前提条件是这两个域名必须属于同一个基础域名，而且所用的协议，端口都要一致。</p><p>否则任何域名的子级域名地址都可以对父级发起xss攻击。</p><p>只有父子级都通过显示得设置 document.domain 才能达到跨域访问资源的目的。</p><p><a href="https://juejin.cn/post/6844903767226351623" target="_blank" rel="noopener">https://juejin.cn/post/6844903767226351623</a></p><p><a href="https://blog.csdn.net/nlznlz/article/details/79506655" target="_blank" rel="noopener">https://blog.csdn.net/nlznlz/article/details/79506655</a></p><p><a href="https://www.chromestatus.com/feature/5428079583297536" target="_blank" rel="noopener">https://www.chromestatus.com/feature/5428079583297536</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/domain" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Document/domain</a></p><p><a href="https://juejin.cn/post/6844904135569965064" target="_blank" rel="noopener">https://juejin.cn/post/6844904135569965064</a></p><p><a href="https://mp.weixin.qq.com/s/tE2anhs0bZJv-9IWoFSphw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/tE2anhs0bZJv-9IWoFSphw</a></p><p>注：某一页面的 domain 默认等于 window.location.hostname。</p><h3 id="postmessage"><a href="#postmessage" class="headerlink" title="postmessage"></a>postmessage</h3><p>用来解决 iframe 跨域时数据通信。</p></div></div></section></div></div></div><div class="push"></div><footer class="footer-content"><div class="container"><div class="row"><div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-about"><h2>About</h2><p>享受编程和技术所带来的快乐</p></div><div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-categories"><h2>Categories</h2><p><a class="footer-post" href="/categories/html/">html</a> <a class="footer-post" href="/categories/scratch/">scratch</a> <a class="footer-post" href="/categories/jotting/">jotting</a> <a class="footer-post" href="/categories/pl/">pl</a></p></div><div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 footer-search"><h2>Search</h2><form class="site-search-form"><input type="text" id="local-search-input" class="st-search-input"></form><div id="local-search-result" class="local-search-result-cls"></div></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><ul class="list-inline footer-social-icons"></ul></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><div class="footer-copyright">Copyright©Tracy-xu'Blog. All Rights Reserved.</div></div></div></div></footer><script src="/plugins/jquery-2.1.4.min.js"></script><script src="/plugins/TweenMax.min.js"></script><script src="/plugins/featherlight/featherlight.min.js"></script><script src="/js/main.js"></script></body></html><!-- rebuild by neat -->